var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,C,A){e instanceof String&&(e=String(e));for(var c=e.length,z=0;z<c;z++){var a=e[z];if(C.call(A,a,z,e))return{i:z,v:a}}return{i:-1,v:void 0}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,C,A){e!=Array.prototype&&e!=Object.prototype&&(e[C]=A.value)};$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(e,C,A,c){if(C){A=$jscomp.global;e=e.split(".");for(c=0;c<e.length-1;c++){var z=e[c];z in A||(A[z]={});A=A[z]}e=e[e.length-1];c=A[e];C=C(c);C!=c&&null!=C&&$jscomp.defineProperty(A,e,{configurable:!0,writable:!0,value:C})}};$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(e,A){return $jscomp.findInternal(this,e,A).v}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(e){var C=0;return $jscomp.iteratorPrototype(function(){return C<e.length?{done:!1,value:e[C++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};$jscomp.iteratorFromArray=function(e,C){$jscomp.initSymbolIterator();e instanceof String&&(e+="");var A=0,c={next:function(){if(A<e.length){var z=A++;return{value:C(z,e[z]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};c[Symbol.iterator]=function(){return c};return c};
$jscomp.polyfill("Array.prototype.keys",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6-impl","es3");window.themifybuilderapp=window.themifybuilderapp||{};
(function(e){var C=e.ui.sortable.prototype._mouseStart,A=e("body").hasClass("full-section-scrolling");e.ui.sortable.prototype._mouseStart=function(a,b,c){this._trigger("beforeStart",a,this._uiHash());C.apply(this,[a,b,c])};void 0===e.fn.themifySerializeObject&&(e.fn.themifySerializeObject=function(){for(var a={},b=0,c=this.length;b<c;++b){var g=this[b].type;if(e(this[b]).hasClass("wp-editor-area")&&void 0!==tinyMCE){var f=tinyMCE.get(this[b].id);f&&(this[b].value=f.getContent())}if(""!==this[b].value&&
this[b].name&&("text"===g||"radio"===g||"checkbox"===g||"textarea"===g||"select-one"===g||"hidden"===g||"email"===g||"select"===g||"select-multiple"===g)){var f=this[b].name,h=this[b].value;"select-multiple"===g&&(h=jQuery(this[b]).val());if("radio"===g||"checkbox"===g)h=this[b].checked&&h;void 0!==a[f]?(!a[f].push&&(a[f]=[a[f]]),h&&a[f].push(h)):h&&(a[f]=h)}}return a});var c=themifybuilderapp={activeModel:null,Models:{},Collections:{},Mixins:{},Views:{Modules:{},Rows:{},SubRows:{},Columns:{},Controls:{}},
Forms:{},Utils:{},Instances:{Builder:{}},cache:{repeaterElements:{}}},z=[];c.autoSaveCid=null;c.hasChanged=null;c.editing=!1;c.init=!1;c.scrollTo=!1;c.eventName=!1;c.beforeEvent=!1;c.saving=!1;c.rowStyling=[];c.saveCid=!1;c.activeBreakPoint="desktop";c.zoomMeta={isActive:!1,size:100};c.isPreview=!1;c.isComponentSaved=[];c.Models.Module=Backbone.Model.extend({defaults:{elType:"module",mod_name:"",mod_settings:{}},initialize:function(){c.Models.Registry.register(this.cid,this)},toRenderData:function(){return{slug:this.get("mod_name"),
name:this.get("mod_name"),excerpt:this.getExcerpt()}},getExcerpt:function(a){a=a||this.get("mod_settings");return this.limitString(a.content_text||a.content_box||a.plain_text||"",100)},limitString:function(a,b){var c="";""!==a&&(a=this.stripHtml(a).toString(),c=a.length>b?a.substr(0,b):a);return c},stripHtml:function(a){var b=document.createElement("div");b.innerHTML=a;return b.textContent||b.innerText||""},setData:function(a){a=c.Views.init_module(a,c.mode);a.model.trigger("custom:change",a)},backendLivePreview:function(){e(".tb_element_cid_"+
this.cid).find(".module_excerpt").text(this.getExcerpt(z))},getPreviewSettings:function(){return _.extend({cid:this.cid},themifyBuilder.modules[this.get("mod_name")].defaults,z)}});c.Models.SubRow=Backbone.Model.extend({defaults:{elType:"subrow",row_order:0,gutter:"gutter-default",column_alignment:"col_align_top",background_video:"",mutevideo:"",unloopvideo:"",desktop_dir:"ltr",tablet_dir:"ltr",tablet_landscape_dir:"ltr",mobile_dir:"ltr",col_mobile:"-auto",col_tablet_landscape:"-auto",col_tablet:"-auto",
cols:{},styling:{}},initialize:function(){c.Models.Registry.register(this.cid,this)},setData:function(a){a=c.Views.init_subrow(a,c.mode);a.model.trigger("custom:change",a)}});c.Models.Column=Backbone.Model.extend({defaults:{elType:"column",column_order:"",grid_class:"",component_name:"column",background_video:"",mutevideo:"",unloopvideo:"",modules:{},styling:{}},initialize:function(){c.Models.Registry.register(this.cid,this)},setData:function(a){a=c.Views.init_column(a,c.mode);a.model.trigger("custom:change",
a)}});c.Models.Row=Backbone.Model.extend({defaults:{elType:"row",row_order:0,gutter:"gutter-default",column_alignment:A?"col_align_middle":"col_align_top",desktop_dir:"ltr",tablet_dir:"ltr",tablet_landscape_dir:"ltr",mobile_dir:"ltr",col_mobile:"-auto",col_tablet_landscape:"-auto",col_tablet:"-auto",background_video:"",mutevideo:"",unloopvideo:"",cols:{},styling:{}},initialize:function(){c.Models.Registry.register(this.cid,this)},setData:function(a){a=c.Views.init_row(a,c.mode);a.model.trigger("custom:change",
a)}});c.Collections.Rows=Backbone.Collection.extend({model:c.Models.Row});c.Models.Registry={items:{},register:function(a,b){this.items[a]=b},lookup:function(a){return this.items[a]||null},remove:function(a){delete this.items[a]},destroy:function(){_.each(this.items,function(a,b){a.destroy()});this.items={};console.log("destroy registry")}};c.Models.setValue=function(a,b,d){d=d||!1;c.Models.Registry.lookup(a).set(b,{silent:d})};c.vent=_.extend({},Backbone.Events);c.Views.register_module=function(a,
b){"default"!==a&&(this.Modules[a]=this.Modules["default"].extend(b))};c.Views.init_module=function(a,b){if(void 0===themifyBuilder.modules[a.mod_name])return!1;b=b||"default";void 0===a.mod_settings&&void 0!==themifyBuilder.modules[a.mod_name].defaults&&(a.mod_settings=_.extend({},themifyBuilder.modules[a.mod_name].defaults));var d=a instanceof c.Models.Module?a:new c.Models.Module(a),g=new (this.get_module(b))({model:d,type:b});return{model:d,view:g}};c.Views.get_module=function(a){a=a||"default";
return this.module_exists(a)?this.Modules[a]:this.Modules["default"]};c.Views.unregister_module=function(a){"default"!==a&&this.module_exists(a)&&delete this.Modules[a]};c.Views.module_exists=function(a){return this.Modules.hasOwnProperty(a)};c.Views.register_column=function(a,b){"default"!==a&&(this.Columns[a]=this.Columns["default"].extend(b))};c.Views.init_column=function(a,b){b=b||"default";var d=a instanceof c.Models.Column?a:new c.Models.Column(a),g=new (this.get_column(b))({model:d,type:b});
return{model:d,view:g}};c.Views.get_column=function(a){a=a||"default";return this.column_exists(a)?this.Columns[a]:this.Columns["default"]};c.Views.unregister_column=function(a){"default"!==a&&this.column_exists(a)&&delete this.Columns[a]};c.Views.column_exists=function(a){return this.Columns.hasOwnProperty(a)};c.Views.register_subrow=function(a,b){"default"!==a&&(this.SubRows[a]=this.SubRows["default"].extend(b))};c.Views.init_subrow=function(a,b){b=b||"default";var d=a instanceof c.Models.SubRow?
a:new c.Models.SubRow(a),g=new (this.get_subrow(b))({model:d,type:b});return{model:d,view:g}};c.Views.get_subrow=function(a){a=a||"default";return this.subrow_exists(a)?this.SubRows[a]:this.SubRows["default"]};c.Views.unregister_subrow=function(a){"default"!==a&&this.subrow_exists(a)&&delete this.SubRows[a]};c.Views.subrow_exists=function(a){return this.SubRows.hasOwnProperty(a)};c.Views.register_row=function(a,b){"default"!==a&&(this.Rows[a]=this.Rows["default"].extend(b))};c.Views.init_row=function(a,
b){var d=a.attributes;if(void 0===d||void 0!==d.cols&&(0<Object.keys(d.cols)||0<d.cols.length)||void 0!==d.styling&&0<Object.keys(d.styling).length){b=b||"default";var d=a instanceof c.Models.Row?a:new c.Models.Row(a),g=new (this.get_row(b))({model:d,type:b});return{model:d,view:g}}return!1};c.Views.get_row=function(a){a=a||"default";return this.row_exists(a)?this.Rows[a]:this.Rows["default"]};c.Views.unregister_row=function(a){"default"!==a&&this.row_exists(a)&&delete this.Rows[a]};c.Views.row_exists=
function(a){return this.Rows.hasOwnProperty(a)};c.Views.BaseElement=Backbone.View.extend({type:"default",events:{"click .themify_builder_copy_component":"copy","click .themify_builder_paste_component":"paste","click .themify_builder_import_component":"import","click .themify_builder_export_component":"export","click .themify_builder_save_component":"save","click .themify_duplicate":"duplicate","click .themify_delete":"delete"},initialize:function(a){_.extend(this,_.pick(a,"type"));this.listenTo(this.model,
"custom:change",this.modelChange);this.listenTo(this.model,"destroy",this.remove)},modelChange:function(){this.$el.attr(_.extend({},_.result(this,"attributes")));var a=this.render();this.model.get("elType");var b=c.beforeEvent.data("cid");e(".tb_element_cid_"+b).replaceWith(a.el);"visual"===c.mode?this.model.trigger("visual:change"):("row"===c.eventName&&(b=this.$el.data("cid")),c.vent.trigger("dom:change",b,c.beforeEvent,this.$el,c.eventName),c.Mixins.Builder.update(this.$el),"row"===c.eventName&&
c.vent.trigger("dom:builder:change"))},remove:function(){this.$el.remove()},copy:function(a){a.preventDefault();a.stopPropagation();var b=e(a.currentTarget);a=ThemifyBuilderCommon.detectBuilderComponent(b);switch(a){case "row":case "subrow":var c=b.closest(".module_"+a);break;case "module":c=b.closest(".active_module");break;case "column":case "sub-column":c=b.closest(".module_column")}c=this.getData(c,a);"sub-column"===a&&(c.component_name=a);ThemifyBuilderCommon.Clipboard.set(a,c)},paste:function(a){a.preventDefault();
a.stopPropagation();var b=e(a.currentTarget),d=ThemifyBuilderCommon.detectBuilderComponent(b);a=ThemifyBuilderCommon.Clipboard.get(d);if(!1===a)ThemifyBuilderCommon.alertWrongPaste();else if(ThemifyBuilderCommon.confirmDataPaste()){var b=b.closest("[data-cid]"),g=c.Models.Registry.lookup(b.data("cid"));c.eventName="row";if("column"===d||"sub-column"===d)a.grid_class=c.Utils.filterClass(b.prop("class")),b.hasClass("first")?a.grid_class+=" first":b.hasClass("last")&&(a.grid_class+=" last"),(d=b[0].style.width)?
a.grid_width=d.replace("%",""):delete a.grid_width;c.beforeEvent=ThemifyBuilderCommon.Lightbox.clone(b);g.setData(a)}},"import":function(a){a.preventDefault();a.stopPropagation();a=e(a.currentTarget);var b=ThemifyBuilderCommon.detectBuilderComponent(a),d=a.closest("[data-cid]"),g=c.Models.Registry.lookup(d.data("cid")),f={data:{action:"tb_component_data",component:b,type:"import"}};if("column"===b||"sub-column"===b){var h=a.closest(".module_column");var k=h.closest("column"===b?".module_row":".module_subrow").index();
f.data.indexData={row:k,col:h.index()}}ThemifyBuilderCommon.Lightbox.open(f,null,function(){var a=this.$lightbox;a.find("#builder_submit_import_component_form").on("click",function(f){f.preventDefault();f=a.find("#tb_data_field");f=JSON.parse(f.val());if("column"===b&&"sub-column"===f.component_name||"sub-column"===b&&"column"===f.component_name)f.component_name=b;if(void 0===f.component_name||f.component_name!==b)ThemifyBuilderCommon.alertWrongPaste();else{f=c.Utils.clear(f,!0);if("column"===b||
"sub-column"===b)f.column_order=h.index(),f.grid_class=h.prop("class"),"column"===b?f.row_order=k:(f.sub_row_order=k,f.row_order=h.closest(".module_row").index(),f.col_order=h.parents(".module_column").index());c.eventName="row";c.beforeEvent=ThemifyBuilderCommon.Lightbox.clone(d);g.setData(f);ThemifyBuilderCommon.Lightbox.close()}})})},getData:function(a,b){var d={};var g=b||ThemifyBuilderCommon.detectBuilderComponent(a);switch(g){case "row":case "subrow":var f=a.closest(".module_"+g);var e=f.index();
d=c.Utils._getRowSettings(f[0],e,g);break;case "module":d=c.Models.Registry.lookup(a.closest(".active_module").data("cid")).attributes;d=c.Utils.clear(d,!0);break;case "column":case "sub-column":d=a.closest(".module_column"),f=d.closest("column"===g?".module_row":".module_subrow"),e=f.index(),g=c.Utils._getRowSettings(f[0],e,"column"===g?"row":"subrow"),d=g.cols[d.index()]}return d},"export":function(a){a.preventDefault();a.stopPropagation();var b=e(a.currentTarget);a=ThemifyBuilderCommon.detectBuilderComponent(b);
var c=this.getData(b,a),b={data:{action:"tb_component_data",component:a,type:"export"}};c.component_name=a;c=JSON.stringify(c);ThemifyBuilderCommon.Lightbox.open(b,null,function(){this.$lightbox.find("#tb_data_field").val(c).on("click",function(){e(this).trigger("focus").trigger("select")})})},duplicate:function(a){a.preventDefault();a.stopPropagation();a=e(a.currentTarget).closest("[data-cid]");var b=ThemifyBuilderCommon.Lightbox.clone(a),d=c.Models.Registry.lookup(b.data("cid"));a.removeClass("tb_element_cid_"+
d.cid);b.hide().insertAfter(a);var g="module"===d.get("elType")?"mod_settings":"styling",f=this.getData(b,d.get("elType"));if(ThemifyBuilderCommon.Lightbox.$lightbox.is(":visible")&&c.activeModel.cid==d.cid){var h=c.Forms.serialize("themify_builder_options_setting"),k=c.Forms.serialize("themify_builder_options_animation"),l=c.Forms.serialize("themify_builder_options_visibility"),m=e.extend(!0,{},c.Mixins.Common.styleData),m=c.Forms.serialize("themify_builder_options_styling",m),m=c.Utils.clear(m,
!0),h=e.extend(!0,m,h,k,l),h=c.Utils.clear(h);f[g]=h}c.eventName="duplicate";c.beforeEvent=b;d.setData(f);a.addClass("tb_element_cid_"+d.cid)},editComponent:function(){c.hasChanged=!1;if(c.autoSaveCid!==c.activeModel.cid){var a=c.activeModel.get("elType"),b="module"===a?c.activeModel.get("mod_name"):a;ThemifyBuilderCommon.Lightbox.open({loadMethod:"inline",templateID:"builder_form_"+b},function(b){c.Mixins.Common.editComponentCallback(b,a,!1,!1)},function(b){b=ThemifyBuilderCommon.Lightbox.$lightbox;
c.activeModel.get("styleClicked")?b.find('a[href="#themify_builder_options_styling"]').trigger("click"):c.activeModel.get("visibileClicked")?b.find('a[href="#themify_builder_options_visibility"]').trigger("click"):new SimpleBar(b.find("#"+("column"===a||"subrow"===a?"themify_builder_options_styling":"themify_builder_options_setting"))[0]);c.autoSaveCid=c.activeModel.cid})}},"delete":function(a){a.preventDefault();a.stopPropagation();a=e(a.currentTarget);var b=ThemifyBuilderCommon.detectBuilderComponent(a);
if(confirm(themifyBuilder.i18n[b+"DeleteConfirm"])){var d=a.closest("[data-cid]");a=d.data("cid");if(b=c.Models.Registry.lookup(a)){var d=d.closest(".module_row"),g="row",f="",h={};"row"===b.get("elType")?(h.pos_cid=d.next(".module_row"),h.pos="before",0===h.pos_cid.length&&(h.pos="after",h.pos_cid=d.prev(".module_row")),g="delete_row",h.pos_cid=h.pos_cid.data("cid")):a=d.data("cid");d=ThemifyBuilderCommon.Lightbox.clone(d);b.destroy();"row"!==b.get("elType")?f=e(".tb_element_cid_"+a):c.vent.trigger("dom:builder:change");
c.vent.trigger("dom:change",a,d,f,g,h)}}},save:function(a){a.preventDefault();a.stopPropagation();var b=e(a.currentTarget);a=ThemifyBuilderCommon.detectBuilderComponent(b);switch(a){case "row":var d=b.closest(".module_"+a).get(0);d=c.Utils._getRowSettings(d,0);break;case "module":d=b.closest(".active_module"),d=c.Models.Registry.lookup(d.data("cid")),d={mod_name:d.get("mod_name"),mod_settings:d.get("mod_settings")}}a={data:{action:"tb_library_item_form",postid:themifyBuilder.post_ID,model:this.model.cid,
item:JSON.stringify(d),type:a}};ThemifyBuilderCommon.Lightbox.open(a)}});c.Views.BaseElement.extend=function(a){var b=this,c=Backbone.View.extend.apply(this,arguments);c.prototype.events=_.extend({},this.prototype.events,a.events);c.prototype.initialize=function(){_.isFunction(b.prototype.initialize)&&b.prototype.initialize.apply(this,arguments);_.isFunction(a.initialize)&&a.initialize.apply(this,arguments)};return c};c.Views.Modules["default"]=c.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_module module-"+
this.model.get("mod_name")+" active_module tb_element_cid_"+this.model.cid,"data-cid":this.model.cid}},template:wp.template("builder_module_item"),events:{dblclick:"edit","click .themify_module_options":"edit","click .themify_builder_module_styling":"edit","click .tb_visibility_component ":"edit","click .themify_module_swap":"swap"},initialize:function(){this.listenTo(this,"edit",this.edit);this.listenTo(this,"swap",this.swap);this.listenTo(this.model,"dom:module:unsaved",this.removeUnsaved);this.listenTo(this.model,
"change:view",this.setView)},removeUnsaved:function(){this.model.destroy()},render:function(){this.el.innerHTML=this.template(this.model.toRenderData());"layout-part"==this.model.get("mod_name")&&("visual"==this.type?e('<li><a href="#" class="themify_module_swap ti-reload themify-tooltip-bottom">Swap<span class="themify_tooltip">Swap</span></a></li>').insertBefore(this.$el.find(".themify_module_options").parent()):e('<li><a href="#" class="themify_module_swap ti-reload" >Swap</a></li>').insertBefore(this.$el.find(".themify_module_options").parent()));
ThemifyBuilderCommon.inLightboxIframe()&&(this.$el.find("a.themify_builder_save_component").remove(),"layout-part"==this.model.get("mod_name")&&this.$el.find("a.themify_module_options").remove());"layout-part"==this.model.get("mod_name")&&this.$el.find("a.themify_builder_save_component").remove();return this},setView:function(a){this.setElement(a)},edit:function(a){if(c.isPreview)return!0;"layout-part"==this.model.get("mod_name")&&a&&("dblclick"==a.type||e(a.target).hasClass("themify_module_options"))?
this.swap(a):(null!==a&&(a.preventDefault(),a.stopPropagation(),a.currentTarget.classList.contains("themify_builder_module_styling")?this.model.set({styleClicked:!0},{silent:!0}):a.currentTarget.classList.contains("tb_visibility_component")&&this.model.set({visibileClicked:!0},{silent:!0})),c.activeModel&&void 0!==c.activeModel.get("is_new")&&c.activeModel.unset("is_new",{silent:!0}),this.model.cid!==c.autoSaveCid&&null!==c.autoSaveCid&&c.Forms.saveComponent(null),c.activeModel=this.model,this.editComponent())},
swap:function(a){if("layout-part"==this.model.get("mod_name")){if(!_.isNull(a)&&!_.isUndefined(a)&&(a.preventDefault(),e(a.target).hasClass("themify_module_swap"))){this.edit(a);return}c.activeModel=this.model;var b=this;e.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{action:"tb_layout_part_swap",nonce:themifyBuilder.tb_load_nonce,slug:this.model.get("mod_settings").selected_layout_part,page:!1},success:function(a){if(a){window.highest_iframe=window.highest_iframe?window.highest_iframe:window.top.document;
a="string"===typeof a?JSON.parse(a):a;highest_iframe.layoutpart={margin:"",overlay:"",model:function(){if("visual"==b.type){var a=c.Models.Registry.items,d=b.model.get("mod_settings"),g;for(g in a)if("module"==a[g].get("elType")&&"layout-part"==a[g].get("mod_name")&&d.selected_layout_part==a[g].get("mod_settings").selected_layout_part){var e=a[g].get("mod_settings");e.unsetKey=!0;a[g].trigger("custom:preview:refresh",e)}}}};var d=wp.template("builder_layoutpart_lightbox")({link:a.url});a=e("body").append('<div class="themify_builder_overlay_2" style="position: fixed; width: 100%; height: 100%; top: 0; left: 0; bottom: 0; right: 0; z-index: 9990; overflow: hidden;">&nbsp;</div>').children(".themify_builder_overlay_2")[0];
"visual"==c.mode?(a.insertAdjacentHTML("afterend",d),e("body",highest_iframe).addClass("themify_builder_layoutPart_edit"),e("#tb_toolbar",highest_iframe).hide(),d=e(".themify_builder_workspace_container",highest_iframe),highest_iframe.layoutpart.margin=d.css("margin"),d.css({margin:"0px"})):a.insertAdjacentHTML("beforebegin",d);e(a).css({backgroundColor:"rgba(0,0,0,0.7)"}).show();highest_iframe.layoutpart.overlay=a}}})}}});c.Views.Columns["default"]=c.Views.BaseElement.extend({tagName:"div",attributes:function(){var a=
"column"===this.model.get("component_name")?"":" sub_column",a={"class":"module_column tb-column tb_element_cid_"+this.model.cid+" "+this.model.get("grid_class")+a,"data-cid":this.model.cid};this.model.get("grid_width")&&(a.style="width:"+this.model.get("grid_width")+"%");return a},template:wp.template("builder_column_item"),events:{"click .themify_builder_option_column":"edit","click .js-tb_empty_row_btn":"showModPanel"},initialize:function(){this.listenTo(this.model,"change:view",this.setView)},
render:function(a){this.el.innerHTML=this.template({component_name:this.model.get("component_name")});var b=this.model.get("modules");!c.id&&c.saveCid&&(c.rowStyling[this.model.cid]=1);if(b){var d=document.createDocumentFragment(),g;for(g in b)if(void 0!==b[g]&&null!==b[g]){var f=b[g],e=a?a+"-"+g:!1,k=void 0===f.cols?c.Views.init_module(f,this.type):c.Views.init_subrow(f,this.type);if(k){var l=k.view.render(e);c.id&&f.mod_name?(c.VisualCache[k.model.cid]=f.mod_name+"-"+c.id+"-"+e,l.$el.children(".module")[0].className+=
" "+c.VisualCache[k.model.cid]):!c.id&&c.saveCid&&(c.rowStyling[k.model.cid]=1);d.appendChild(l.el)}}this.el.getElementsByClassName("themify_module_holder")[0].appendChild(d)}return this},edit:function(a){a.preventDefault();a.stopPropagation();this.model.cid!==c.autoSaveCid&&null!==c.autoSaveCid&&c.Forms.saveComponent(null);c.activeModel=this.model;this.editComponent()},setView:function(a){this.setElement(a)},showModPanel:function(a){a.preventDefault();c.toolbar.Panel.show()}});c.Views.SubRows["default"]=
c.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_sub_row module_subrow active_module clearfix tb_element_cid_"+this.model.cid,"data-cid":this.model.cid}},template:wp.template("builder_subrow_item"),events:{"click .themify_builder_style_subrow":"edit"},initialize:function(){this.listenTo(this.model,"change:view",this.setView)},render:function(a){var b=this.model.get("cols"),d=Object.keys(b).length;this.el.innerHTML=this.template();c.id&&(c.VisualCache[this.model.cid]=
"sub_row_"+a,this.el.className+=" "+c.VisualCache[this.model.cid]);if(0<d){for(var g=document.createDocumentFragment(),f=0;f<=d;++f)if(void 0!==b[f]){b[f].component_name="sub-column";var e=a+"-"+f,k=c.Views.init_column(b[f],this.type),l=k.view.render("sub_row_"+e).el;c.id&&(c.VisualCache[k.model.cid]="sub_column_post_"+c.id+" sub_column_"+e,l.className+=" "+c.VisualCache[k.model.cid]);g.appendChild(l)}this.el.getElementsByClassName("subrow_inner")[0].appendChild(g)}c.init&&!c.id&&c.Utils.selectedGridMenu(this.el);
return this},setView:function(a){this.setElement(a)},edit:function(a){a.stopPropagation();a.preventDefault();this.model.cid!==c.autoSaveCid&&null!==c.autoSaveCid&&c.Forms.saveComponent(null);c.activeModel=this.model;this.editComponent()}});c.Views.Rows["default"]=c.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_row module_row clearfix tb_element_cid_"+this.model.cid,"data-cid":this.model.cid}},template:wp.template("builder_row_item"),events:{"click .themify_builder_option_row":"edit",
"click .themify_builder_style_row":"edit","click .tb_visibility_component ":"edit","click .themify_builder_grid_list li a":"_gridMenuClicked","click .themify_builder_grid_list_wrapper .grid_tabs li a":"_switchGridTabs","click .themify_builder_column_alignment li a":"_columnAlignmentMenuClicked","click .themify_builder_column_direction li a":"_columnDirectionMenuClicked","change .gutter_select":"_gutterChange","click .toggle_row":"toggleRow","click .themify_builder_toggle_row":"toggleRow"},initialize:function(){this.listenTo(this.model,
"change:view",this.setView)},render:function(a){var b=this.model.get("cols"),d=Object.keys(b).length;this.el.innerHTML=this.template();c.saveCid&&(c.rowStyling[this.model.cid]=1);ThemifyBuilderCommon.inLightboxIframe()&&this.$el.find("a.themify_builder_save_component").remove();if(0<d){for(var g=document.createDocumentFragment(),f,e=!1,k=0;k<=d;++k)if(void 0!==b[k]){b[k].component_name="column";var l=c.Views.init_column(b[k],this.type);c.id&&(f=l.model.get("column_order"),void 0===f&&(f=k),e=a+"-"+
f);var m=l.view.render(e).el;c.id&&(c.VisualCache[l.model.cid]="module_column_"+f+" tb_"+c.id+"_column",m.className+=" "+c.VisualCache[l.model.cid]);g.appendChild(m)}this.el.getElementsByClassName("row_inner")[0].appendChild(g)}else c.Utils._addNewColumn({newclass:"col-full",component:"column",type:this.type},this.$el.find(".row_inner"));c.Utils.selectedGridMenu(this.el);return this},edit:function(a){a.stopPropagation();a.preventDefault();a.currentTarget.classList.contains("themify_builder_style_row")?
this.model.set({styleClicked:!0},{silent:!0}):a.currentTarget.classList.contains("tb_visibility_component")&&this.model.set({visibileClicked:!0},{silent:!0});this.model.cid!==c.autoSaveCid&&null!==c.autoSaveCid&&c.Forms.saveComponent(null);c.activeModel=this.model;this.editComponent()},_switchGridTabs:function(a){c.scrollTo=e(a.currentTarget).closest("[data-cid]");c.Forms.lightbox_switcher(a)},_gridMenuClicked:function(a){a.preventDefault();a=e(a.currentTarget);var b=a.data("grid"),d=a.data("handle"),
g=!1,f=a.data("type"),h="desktop"===f,k=ThemifyBuilderCommon.Lightbox.clone(a.closest(".module_row"));a.parent().addClass("selected").siblings().removeClass("selected");if("module"===d){if("-full"!==b[0]){g=!0;var l=c.Views.init_subrow({cols:[{grid_class:"col-full"}]},c.mode);var m=a.closest(".active_module"),q=m.clone();q.insertAfter(m);var n=l.view.render().$el.find(".themify_module_holder").prepend(m).end().insertAfter(q).find("."+a.attr("class").replace(" ",".")).closest("li").addClass("selected").siblings().removeClass("selected").end().end().end().find(".subrow_inner");
q.remove();l=n.closest(".module_subrow")}}else g="subrow"===d,l=a.closest(".module_"+d),n=l.find("."+d+"_inner").first();if(0!==n.length){if(h||"module"===d){f=n;var w=a.data("col");f=f.add(l);void 0===w&&(w=1,a.data("col",w));f.removeClass("col-count-1 col-count-"+n.attr("data-basecol")).addClass("col-count-"+w);n.attr("data-basecol",w);h&&a.closest(".themify_builder_grid_list_wrapper").find(".themify_builder_grid_reposnive .themify_builder_grid_list").each(function(){var a=e(this).find(".selected"),
b=a.find("a"),c=b.data("type"),b=b.data("col");void 0!==b&&(b>w||4===w&&3===b||4<=w&&4<=b&&w!=b)&&(a.removeClass("selected"),n.removeClass("tb_grid_classes col-count-"+n.attr("data-basecol")+" "+n.attr("data-col_"+c)).attr("data-col_"+c,""),e(this).closest(".themify_builder_grid_list").find("."+c+"-auto").parent().addClass("selected"))})}else return"-auto"!==b[0]?(k="column"+b.join("-"),w=a.data("col"),3===w&&n.attr("data-basecol")>w&&(k+=" tb_3col"),n.removeClass(n.attr("data-col_tablet")+" "+n.attr("data-col_tablet_landscape")+
" "+n.attr("data-col_mobile")).addClass(k+" tb_grid_classes col-count-"+n.attr("data-basecol")).attr("data-col_"+f,k)):n.removeClass("tb_grid_classes tb_3col col-count-"+n.attr("data-basecol")+" "+n.attr("data-col_"+f)).attr("data-col_"+f,""),"visual"===c.mode&&e("body",top_iframe).height(document.body.scrollHeight),c.Utils.setCompactMode(n.children(".module_column")),!1;f=n.children(".module_column");h=b.length;d="module_column"+(g?" sub_column":"")+" col";for(l=0;l<h;++l)m=f.eq(l),0<m.length?m.removeClass(c.Utils.gridClass.join(" ")).addClass(d+
b[l]):c.Utils._addNewColumn({newclass:d+b[l],component:g?"sub-column":"column",type:c.mode},n);h<n.children().length&&n.children(".module_column").eq(h-1).nextAll().each(function(){e(this).find(".themify_module_holder").first().children().appendTo(e(this).prev().find(".themify_module_holder").first());e(this).remove()});f=n.children();f.removeClass("first last");n.hasClass("direction-rtl")?(f.last().addClass("first"),f.first().addClass("last")):(f.first().addClass("first"),f.last().addClass("last"));
g&&"-full"===b[0]&&(b=n.closest(".module_subrow"),b.closest(".module_column"),g=n.find(".active_module"),g.insertAfter(b),b.remove(),g.find(".themify_builder_grid_list .grid-layout--full").parent().addClass("selected").siblings().removeClass("selected"));c.Utils.columnDrag(n,!0);l=a.closest(".module_row");c.Mixins.Builder.columnSort(l);c.Mixins.Builder.updateModuleSort(l);c.vent.trigger("dom:change",l.data("cid"),k,l,"row")}},_columnAlignmentMenuClicked:function(a){a.preventDefault();a=e(a.currentTarget);
var b=a.data("handle");if("module"!==b&&!a.closest("li").hasClass("selected")){a.closest("li").addClass("selected").siblings("li").removeClass("selected");var d=a.closest(".module_"+b);var g=a.data("alignment"),f=c.Models.Registry.lookup(d.data("cid")),h=ThemifyBuilderCommon.Lightbox.clone(d);d.find("."+b+"_inner").first().removeClass(f.get("column_alignment")).addClass(g);f.set({column_alignment:g},{silent:!0});c.vent.trigger("dom:change",h.data("cid"),h,a.closest(".module_"+b),"row")}},_columnDirectionMenuClicked:function(a){a.preventDefault();
var b=e(a.currentTarget),d=b.data("handle");a=b.data("dir");if("module"!==d&&!b.closest("li").hasClass("selected")){b.closest("li").addClass("selected").siblings("li").removeClass("selected");var b=b.closest(".module_"+d),d=b.find("."+d+"_inner").first(),g=d.children(".module_column"),b=g.first(),g=g.last();"rtl"===a?(b.removeClass("first").addClass("last"),g.removeClass("last").addClass("first"),d.addClass("direction-rtl")):(b.removeClass("last").addClass("first"),g.removeClass("first").addClass("last"),
d.removeClass("direction-rtl"));d.attr("data-"+c.activeBreakPoint+"_dir",a)}},_gutterChange:function(a){a=e(a.currentTarget);var b=a.data("handle");if("module"!==b){var d=a.val();a.find("option").removeAttr("selected").filter('[value="'+d+'"]').attr("selected","selected");var g=a.closest(".module_"+b),f=ThemifyBuilderCommon.Lightbox.clone(g),h=g.find("."+b+"_inner").first(),k=c.Models.Registry.lookup(g.data("cid"));f.find(".themify_builder_"+b+"_top .gutter_select").val(g.data("gutter"));c.Utils.columnDrag(h,
!1,k.get("gutter"),d);h.removeClass(k.get("gutter")).addClass(d);k.set({gutter:d},{silent:!0});c.vent.trigger("dom:change",f.data("cid"),f,a.closest(".module_"+b),"row")}},setView:function(a){this.setElement(a)},toggleRow:function(a){a.preventDefault();a.stopPropagation();var b=e(a.currentTarget).closest(".module_row");b.find(".row_inner").first().slideToggle("fast",function(){b.toggleClass("collapsed")})}});c.Views.Builder=Backbone.View.extend({type:"default",events:{"click .tb-import-layout-button":"importLayoutButton"},
initialize:function(a){_.extend(this,_.pick(a,"type"));c.vent.on("dom:builder:change",this.tempEvents.bind(this));c.vent.on("dom:builder:init",this.init.bind(this))},init:function(a){c.Forms.getFormTemplates();c.init=a;this.rowSort();"visual"===c.mode?(this.updateModuleSort(this.$el),a&&this.initModuleVisualDrag(),setTimeout(function(){c.Utils._onResize(!0)},1500)):(a&&this.initModuleDraggable(c.toolbar.$el),this.updateModuleSort(e("body")));var b=this;setTimeout(function(){c.Utils.setCompactMode(b.el.getElementsByClassName("module_column"))},
1E3);c.vent.trigger("dom:builder:change");this.insertLayoutButton();c.init=!0},render:function(){for(var a=document.createDocumentFragment(),b=this.collection,d=!1,g=0,f=b.length;g<f;++g){var e=c.Views.init_row(b.models[g],this.type);if(!1!==e){c.id&&(d=e.model.get("row_order"),void 0===d&&(d=g));var k=e.view.render(d).el;c.id&&(c.VisualCache[e.model.cid]="themify_builder_"+c.id+"_row module_row_"+d,k.className+=" "+c.VisualCache[e.model.cid]);a.appendChild(k)}}this.el.appendChild(a);c.Utils.columnDrag(!1,
!1);return this},tempEvents:function(){this.newRowAvailable()},insertLayoutButton:function(){this.$el.find(".tb-import-layout-button").remove();2>this.$(".module_row").length&&this.el.insertAdjacentHTML("beforeend",'<a href="#" class="tb-import-layout-button'+(themifyBuilder.is_premium?"":" themify_builder_lite")+'">'+themifyBuilder.i18n.text_import_layout_button+"</a>")},importLayoutButton:function(a){a.preventDefault();c.Views.Toolbar.prototype.loadLayout(a)}});c.Mixins.Common={styleData:{},doTheBinding:function(a,
b,d){var g=!1,f=!1,h=a.data("binding"),k="desktop"!==c.activeBreakPoint;b||void 0===h.empty?b&&void 0!==h[b]?g="radio"===a.attr("type")?a.is(":checked")?h[b]:!1:h[b]:b&&void 0!==h.not_empty?g=h.not_empty:void 0!==h.select&&b!==h.select.value?g=h.select:void 0!==h.checked&&a.is(":checked")?g=h.checked:void 0===h.not_checked||a.is(":checked")||(g=h.not_checked):g=h.empty;void 0!==h.responsive&&a.is("select")&&(f=h.responsive,k&&void 0!==f.disabled&&void 0!==this.styleData.breakpoint_desktop[a.prop("id")]&&
_.contains(f.disabled,this.styleData.breakpoint_desktop[a.prop("id")])&&(g=h[this.styleData.breakpoint_desktop[a.prop("id")]]));if(g){h=[];void 0!==g.show&&(h=g.show);void 0!==g.hide&&(h=h.concat(g.hide));if(void 0===d||0===d.length)d=e("#themify_builder_lightbox_container",top_iframe);b=0;for(h=h.length;b<h;++b)void 0!==g.hide&&void 0!==g.hide[b]&&e("."+g.hide[b],d).addClass("_tf-hide").hide(),void 0!==g.show&&void 0!==g.show[b]&&e("."+g.show[b],d).removeClass("_tf-hide").show();if(void 0!==g.responsive)for(h=
[],void 0!==g.responsive.disabled&&(h=h.concat(g.responsive.disabled)),b=0,h=h.length;b<h;++b)void 0!==g.responsive.disabled&&void 0!==g.responsive.disabled[b]&&(k?e("."+g.responsive.disabled[b],d).addClass("reponive_disable"):e("."+g.responsive.disabled[b],d).removeClass("reponive_disable"))}if(f)for(d=[],void 0!==f.disabled&&(d=d.concat(f.disabled)),b=0,h=d.length;b<h;++b)void 0!==f.disabled&&void 0!==f.disabled[b]&&a.find('option[value="'+f.disabled[b]+'"]').prop("disabled",k)},moduleOptionsBinding:function(){var a=
this;e("#themify_builder_lightbox_container",top_iframe).on("change","[data-binding]",function(){a.doTheBinding(e(this),e.trim(e(this).val()),e(this).closest(".tb_repeatable_field_content"))}).on("click",".themify-layout-icon[data-binding] a",function(){a.doTheBinding(e(this).parent(),e(this).prop("id"),e(this).closest(".tb_repeatable_field_content"))})},mode_change:function(a){function b(a){null===h&&(h=ThemifyBuilderCommon.Lightbox.$lightbox.find("#themify_builder_options_styling")[0]);f.styleData["breakpoint_"+
a]=c.Forms.serialize("themify_builder_options_styling",f.styleData,a,!1)}function d(c,d,g){b(d);f.editComponentCallback(h,a,f.styleData,!0)}var g="module"===a&&void 0!==c.activeModel.get("is_new")?e(".tb_element_cid_"+c.activeModel.cid).closest(".module_row"):e(".tb_element_cid_"+c.activeModel.cid);c.beforeEvent=ThemifyBuilderCommon.Lightbox.clone(g);var f=this,h=null;f.styleData={};f.styleData.breakpoint_desktop=e.extend(!0,{},c.activeModel.get("module"===a?"mod_settings":"styling"));for(var k in themifyBuilder.breakpoints)void 0!==
f.styleData.breakpoint_desktop["breakpoint_"+k]&&(f.styleData["breakpoint_"+k]=f.styleData.breakpoint_desktop["breakpoint_"+k],delete f.styleData.breakpoint_desktop["breakpoint_"+k]);e("body").off("themify_builder_change_mode",d).on("themify_builder_change_mode",d).one("themify_builder_lightbox_before_close",function(){z=[];c.saving&&b(c.activeBreakPoint);e("body").off("themify_builder_change_mode",d)})},editComponentCallback:function(a,b,d,g){var f="styling",h=c.Mixins.Common,k=b,l=[],m=[],q=[],
n=[],w=[],v=[],p=!1,x="desktop"!==c.activeBreakPoint?Object.keys(themifyBuilder.breakpoints).reverse():!1;"module"===b&&(k=c.activeModel.get("mod_name"),f="mod_settings",p=void 0!==c.activeModel.get("is_new"));if(!1!==x){for(var u=x.indexOf(c.activeBreakPoint),r=0;r<=u;++r)x.shift();x.push("desktop")}var D=function(a,b,d,f){var r="";f?r=a.getAttribute("data-input-id"):(r=a.getAttribute("name"))||(r=a.getAttribute("id"));var t=b&&void 0!==b[r]?b[r]:!1;if(g||"px"!==t&&"pixels"!==t&&"solid"!==t&&"|"!==
t&&"default"!==t){var y=e(a),u=a.classList;if(!p&&!1!==x&&!f&&!t)if(u.contains("themify-checkbox"))void 0!==d[r]&&0===y.closest("#themify_builder_options_styling").length&&(t=d[r]);else{f=0;for(var E=x.length;f<E;++f)if(void 0!==d["breakpoint_"+x[f]]&&void 0!==d["breakpoint_"+x[f]][r]){t=d["breakpoint_"+x[f]][r];break}else if("desktop"===x[f]&&void 0!==d[r]){t=d[r];break}}if(u.contains("themify-gradient"))n.push({k:y,v:t}),t&&y.val(t);else if(u.contains("themify-builder-uploader-input"))t?(d=e("<img/>",
{src:t,width:50,height:50}),y.val(t).parent().find(".img-placeholder").html(d)):g&&y.val("").parent().find(".img-placeholder").empty();else if(u.contains("themify-option-query-cat"))t&&(d=y.parent(),f=t.split("|")[0],d.find("#"+r+"_dropdown").children("option[value='"+f+"']").prop("selected",!0),d.find(".query_category_multiple").val(f));else if(u.contains("tb-radio-input-container"))d=null,f=t?t:void 0!==y.data("default")?y.data("default"):!1,!1!==f&&""!==f?(d=y.find("input[value='"+f+"']"),d.is(":disabled")?
d=null:d.prop("checked",!0)):g&&u.contains("tb-icon-radio")&&y.find("input").prop("checked",!1),null===d&&(d=y.find("input:checked")),0<d.length&&u.contains("tb-option-radio-enable")&&m.push(d);else if(u.contains("themify-checkbox")){d=y.find(".tb-checkbox");!t&&_.isEmpty(b)&&(t=d.map(function(){return e(this).is(":checked")?e(this).val():null}).get().join("|"));if(t){var F=t.constructor===Array?t:t.split("|");d.each(function(){-1!==F.indexOf(e(this).val())&&e(this).prop("checked",!0)})}else if(!p||
g)if(f=d.closest(".themify_builder_input").find(".tb_seperate_items input"),f.length){var z=!1;f.each(function(){if(e(this).val().length)return z=!0,!1});d.prop("checked",!z)}else d.prop("checked",!1);u.contains("tb-option-checkbox-enable")&&q.push(d)}else if(u.contains("themify-layout-icon"))t?y.find("a").filter(function(){e(this).removeClass("selected");if(t===e(this).prop("id"))return e(this)}).addClass("selected"):(d=themifyBuilder.modules[k],void 0!==d&&void 0!==d.defaults&&d.defaults[r]?y.find("#"+
d.defaults[r]).addClass("selected"):y.find("a").first().addClass("selected"));else if("SELECT"===a.tagName)t?(y.val(t),u.contains("font-family-select")&&y.data("selected",t)):g&&y.find("option").prop("selected",!1),g&&u.contains("font-family-select")&&(-1===y.prop("tabindex")?y.trigger("change.select"):t&&(d=y.find("optgroup"),void 0!==ThemifyBuilderCommon.safe_fonts[t]?d.first().html('<option selected="selected" data-type="webfont" value="'+t+'">'+ThemifyBuilderCommon.safe_fonts[t]+"</option>"):
d.last().html('<option selected="selected" value="'+t+'">'+ThemifyBuilderCommon.google_fonts[t]+"</option>")));else if("TEXTAREA"===a.tagName||"INPUT"===a.tagName){d="TEXTAREA"===a.tagName;if(t||g)g&&!t&&(t=""),y.val(t),u.contains("minicolors-input")?(f=t,r="",-1!==t.indexOf("_")?(f=c.Utils.toRGBA(t),t=t.split("_"),(r=t[1])||(r=1),y.val(t[0])):t&&(-1===t.indexOf("#")&&(f="#"+t),r=1),y.attr("data-opacity",r).next(".minicolors-swatch").find("span").css({background:f,opacity:r}).closest(".minicolors").next(".color_opacity").val(r)):
d&&!p&&(u.contains("tb-shortcode-input")||u.contains("tb-thumbs-preview"))&&h.getShortcodePreview(y,t);d&&u.contains("tb_lb_wp_editor")&&l.push(y)}else if(u.contains("themify_builder_row_js_wrapper")){var E=t?t.length-1:0,B=e.Event("click",{isTrigger:!0,currentTarget:y.next(".add_new").find("a").first()});void 0===c.cache.repeaterElements[r]&&(b=a.getElementsByClassName("tb_repeatable_field"),c.cache.repeaterElements[r]=e(b[0]).clone());for(f=0;f<E;++f)c.Forms.moduleOptAddRow(B,null);b=a.getElementsByClassName("tb_repeatable_field");
f=0;for(r=b.length;f<r;++f){a=b[f].getElementsByClassName("tb_lb_option_child");for(var E=void 0!==t[f]?t[f]:!1,B=0,A=a.length;B<A;++B)D(a[B],E,d,!0)}w.push({el:y,binding_type:y.data("control-binding")})}y.data("binding")?v.push({el:y,v:t}):y.find(".tb-checkbox").data("binding")&&v.push({el:y.find(".tb-checkbox"),v:t});g||!y.data("control-binding")||u.contains("tb_lb_wp_editor")||u.contains("minicolors-input")||u.contains("themify-gradient")||"repeater"===y.data("control-type")||c.Views.init_control(y.data("control-type"),
{el:y,binding_type:y.data("control-binding"),selector:y.data("live-selector")})}};d=g?d:c.activeModel.get(f);var B=e.extend(!0,{},d);if("desktop"!==c.activeBreakPoint||g)if(void 0!==B["breakpoint_"+c.activeBreakPoint])B=B["breakpoint_"+c.activeBreakPoint];else for(r=0,f=x.length;r<f;++r)if(void 0!==B["breakpoint_"+x[r]]){B=B["breakpoint_"+x[r]];break}f=a.getElementsByClassName("tb_lb_option");r=0;for(u=f.length;r<u;++r)D(f[r],B,d,!1),g||f[r].addEventListener("change",function F(a){a.currentTarget.removeEventListener(a.type,
F);c.hasChanged=!0},{once:!0},!1);f=null;e(".themify_builder_font_preview_wrapper",a).each(function(){e(this).one("focusin",function(){c.hasChanged=!0})});g||(0<w.length&&setTimeout(function(){for(var a=0,b=w.length;a<b;++a)c.Views.init_control("repeater",w[a]);w=null},1),setTimeout(function(){if("module"===b)for(var a=0,c=v.length;a<c;++a)h.doTheBinding(v[a].el,v[a].v);v=null;h.moduleOptionsBinding()},1));setTimeout(function(){for(var a=0,b=m.length;a<b;++a)ThemifyBuilderCommon.Lightbox.clickRadioOption(null,
m[a]);m=null},1);setTimeout(function(){for(var a=0,b=q.length;a<b;++a)ThemifyBuilderCommon.Lightbox.clickCheckboxOption(null,q[a]);q=null},1);setTimeout(function(){h.applyAll_init(g);for(var b=a.getElementsByClassName("border_style"),c=0,d=b.length;c<d;++c)ThemifyBuilderCommon.Lightbox.hideShowBorder(null,e(b[c]))},1);void 0!==e.fn.ThemifyGradient&&setTimeout(function(){for(var a=0,b=n.length;a<b;++a)c.Utils.createGradientPicker(n[a].k,n[a].v,g);n=null},1);g||(setTimeout(function(){ThemifyBuilderCommon.fontPreview(e("#themify_builder_lightbox_container",
top_iframe))},300),p&&"gallery"===k&&setTimeout(function(){e(".tb-gallery-btn",a).trigger("click")},1),setTimeout(function(){c.Utils.builderPlupload("normal")},1),setTimeout(function(){c.Utils.setColorPicker(a)},1),"visual"===c.mode&&(setTimeout(function(){z="module"===b?c.Forms.serialize("themify_builder_options_setting"):B;c.liveStylingInstance.init(z)},1),p||ThemifyBuilderCommon.Lightbox.rememberRow()),setTimeout(function(){if(0<l.length){var a=function(){for(var a=0,b=l.length;a<b;++a)c.Views.init_control("wp_editor",
{el:l[a],binding_type:l[a].data("control-binding"),selector:l[a].data("live-selector")});l=null};if(c.activeModel.get("styleClicked")||c.activeModel.get("visibileClicked"))e("body").one("themify_builder_tabsactive",function(b,c,d){"#themify_builder_options_setting"===c&&a()});else a()}h.mode_change(b)},1),e("body").trigger("editing_"+b+"_option",[k,B,a]),"visual"===c.mode&&window.parent.jQuery("body").trigger("editing_"+b+"_option",[k,B,a]))},applyAll_init:function(a){var b=e(".style_apply_all",top_iframe);
b.off("change.tb_apply_all").on("change.tb_apply_all",function(a){var b=e(this).closest(".themify_builder_input").find(".tb_seperate_items"),c=b.find("li");a=!a.isTrigger;e(this).is(":checked")?(a?c.not(":first-child").slideUp():c.not(":first-child").hide(),b.attr("data-checked",1)):(c.slideDown(),b.removeAttr("data-checked"));a&&c.first().find("select").trigger("change")});a||(b=b.filter(":checked"));b.trigger("change.tb_apply_all")},getShortcodePreview:function(a,b){function c(b){a.next(".tb_shortcode_preview").remove();
b&&a.after(b)}var g=this;void 0===g.galerry_cache&&(g.galerry_cache={});void 0!==g.galerry_cache[b]?c(g.galerry_cache[b]):e.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{action:"tb_load_shortcode_preview",tb_load_nonce:themifyBuilder.tb_load_nonce,shortcode:b},success:function(a){c(a);g.galerry_cache[b]=a}})}};c.Mixins.Builder={rowSortable:{},rowSort:function(){var a=!1,b=this,d,g,f;this.rowSortable={items:".module_row",handle:".themify_builder_row_top",axis:"y",placeholder:"themify_builder_ui_state_highlight",
containment:"parent",tolerance:"pointer",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!1,beforeStart:function(d,f){b.dragScroll();"visual"!==c.mode||f.item.hasClass("collapsed")||(a=!0,f.item.addClass("collapsed ui-sortable-row"))},start:function(a,b){d=b.placeholder.index();f=b.item.outerHeight(!0);b.item.nextAll(".module_row").css("transform","translateY("+f+"px)")},change:function(a,b){g=b.placeholder.index();var c=!1;d>g?(c=e(".module_row"),c=c.slice(g,c.length)):d<g&&(c=e(".module_row").slice(d,
g),f=0);!1!==c&&c.not(".ui-sortable-helper").each(function(){e(this).css("transform","translateY("+f+"px)")});d=g},stop:function(c,d){a&&(d.item.removeClass("collapsed ui-sortable-row"),a=!1);e(".ui-sortable-handle, .module_row").css("transform","");b.dragScroll(!0)},update:function(a,d){d.item.hasClass("predesigned_row")&&e(document).trigger("tb_setpredesignedrows",[d.item.data("slug"),function(a){b.rowDrop(a,d.item)}]);d.item.hasClass("tb_row_grid")&&e(document).trigger("tb_setpremaderows",[d.item.data("slug"),
function(a){b.rowDrop(a,d.item)}]);if("library_item"==d.item.data("type")){var f=c.toolbar.libraryItems.get(d.item.data("main"),d.item.data("id"));f.raw&&(Array.isArray(f.raw)?b.rowDrop(f.raw,d.item):b.rowDrop(Array(f.raw),d.item))}}};"visual"===c.mode&&(this.rowSortable.helper=function(){return e('<div class="themify_builder_sortable_helper"/>')});this.$el.sortable(this.rowSortable);this.columnSort(this.$el)},columnSort:function(a){var b,d=e("body"),g;a.find(".row_inner, .subrow_inner").sortable({items:"> .module_column",
handle:"> .themify_builder_column_action .themify_builder_column_dragger",axis:"x",placeholder:"themify_builder_ui_state_highlight",tolerance:"pointer",cursorAt:{top:20,left:20},beforeStart:function(a,c){d.addClass("themify_builder_drag_start");b=ThemifyBuilderCommon.Lightbox.clone(c.item.closest(".module_row"));g=c.item.siblings();g.css("marginLeft",0)},start:function(a,b){e(".themify_builder_ui_state_highlight").width(b.item.width())},stop:function(a,b){d.removeClass("themify_builder_drag_start");
g.css("marginLeft","")},update:function(a,d){var f=d.item.closest(".ui-sortable"),g=f.children(".module_column");g.removeClass("first last");f.hasClass("direction-rtl")?(g.last().addClass("first"),g.first().addClass("last")):(g.first().addClass("first"),g.last().addClass("last"));c.Utils.columnDrag(f,!1);c.Utils.setCompactMode(g);f=f.closest(".module_row");c.vent.trigger("dom:change",f.data("cid"),b,f,"row")}})},update:function(a){var b=null!==c.activeModel?c.activeModel.get("elType"):c.Models.Registry.lookup(a.data("cid")).get("elType");
"visual"===c.mode&&c.Utils.loadContentJs(a,b);c.Mixins.Builder.columnSort(a);a=a.closest(".module_row");c.Utils.columnDrag(a.find(".row_inner"),!1);c.Utils.columnDrag(a.find(".subrow_inner"),!1);this.updateModuleSort(a)},dragScroll:function(a){var b=e("body",top_iframe);"visual"===c.mode&&(b=b.add(e("body")));void 0===this.top&&(this.top=c.toolbar.$el,this.top=this.top.add(e("#themify_builder_fixed_bottom_scroll",top_iframe)),"visual"!==c.mode&&(this.top=this.top.add("#wpadminbar")));if(!0===a)this.top.off("mouseenter"),
b.removeClass("themify_builder_drag_start");else{var d="desktop"===c.activeBreakPoint?e("body,html"):e("body,html",top_iframe),g="",f=0;"visual"===c.mode?(g=d.height(),f=e(window.parent).height()):g=e("#page-builder").height();b.addClass("themify_builder_drag_start");this.top.off("mouseenter").on("mouseenter",function(a){a=parseInt((g-f)/7);if(0<a){var b=e(this).prop("id");a=("tb_toolbar"===b||"wpadminbar"===b?"-":"+")+("="+a+"px");d.stop().animate({scrollTop:a},800)}else d.stop()})}},updateModuleSort:function(a,
b){var d=b?e(".themify_module_holder"):a.find(".themify_module_holder");if(b)return d.sortable(b),!1;d.each(function(){e(this).data().uiSortable=null});var g=!1,f=!1,h=this,k={placeholder:"themify_builder_ui_state_highlight",items:".active_module",connectWith:".themify_module_holder",revert:100,scroll:!1,tolerance:"pointer",cursorAt:{top:20,left:110},beforeStart:function(a,b){!1===f&&(f=ThemifyBuilderCommon.Lightbox.clone(b.item.closest(".module_row")),"visual"===c.mode&&(b.item.css("height",40),
g=!0),h.dragScroll())},stop:function(a,b){h.dragScroll(!0);if("dragstop"!==a.type){g&&(b.item.css("height",""),g=!1);var d=b.item.closest(".module_row");c.hasChanged=!0;c.vent.trigger("dom:change",b.item.data("cid"),f,d,"sort",{before:f.data("cid"),after:d.data("cid")})}f=!1},update:function(a,b){b.sender?(b.item.hasClass("module_subrow")&&0<b.item.parents(".module_subrow").length&&(b.item.find(".active_module").clone().insertAfter(b.item),b.item.remove()),c.vent.trigger("dom:builder:change")):b.item.hasClass("tb_module_dragging_helper")&&
(z=[],h.moduleDrop(b.item,!1))}};"visual"===c.mode&&(k.helper=function(){return e('<div class="themify_builder_sortable_helper"/>')},k.handle=".themify_builder_module_front_overlay, .themify_builder_subrow_top");d.sortable(k)},initModuleDraggable:function(a){var b=this;a.find(".themify_builder_module, .dragable_library_item_module, .dragable_library_item_part").draggable({appendTo:"body",helper:"clone",revert:"invalid",scroll:!1,connectToSortable:".themify_module_holder",containment:"#themify_builder_row_wrapper,.themify_builder_content",
cursorAt:{top:10,left:40},start:function(a,g){b.dragScroll();g.helper.addClass("tb_module_dragging_helper").removeClass("themify_builder_module dragable_library_item_module dragable_library_item_part");c.toolbar.common.btn.hide()},stop:function(a,c){c.helper.css({visibility:"hidden"});b.dragScroll(!0)}})},initModuleVisualDrag:function(){var a=this;c.toolbar.$el.find(".themify_builder_module, .dragable_library_item_module, .dragable_library_item_part").ThemifyDraggable({iframe:"#themify_builder_site_canvas_iframe",
dropitems:".themify_module_holder",elements:".active_module",onDragStart:function(a,d){c.toolbar.common.btn.hide()},onDrag:function(){},onDragEnd:function(a,c){},onDrop:function(b,c,g){"library_item"==c.data("type")&&c.css({visibility:"hidden"});a.moduleDrop(c,!1)}})},initRowDraggable:function(a){var b=this;a.find(".predesigned_row:not(.tb_premade_rows_grid), .dragable_library_item_row").draggable({appendTo:"body",helper:"clone",revert:"invalid",connectToSortable:"#themify_builder_row_wrapper,.themify_builder_content",
cursorAt:{top:10,left:40},start:function(a,g){b.dragScroll();g.helper.addClass("tb_module_dragging_helper").find(".tb_predesigned_rows_list_image").remove();c.toolbar.common.btn.hide()},stop:function(a,c){c.helper.css({visibility:"hidden"});b.dragScroll(!0)}})},initGridsDraggable:function(a){var b=this;a.find(".tb_premade_rows_grid .tb_row_grid").draggable({appendTo:"body",helper:"clone",revert:"invalid",connectToSortable:"#themify_builder_row_wrapper,.themify_builder_content,.themify_module_holder",
cursorAt:{top:10,left:40},start:function(a,g){b.dragScroll();g.helper.addClass("tb_module_dragging_helper");c.toolbar.common.btn.hide()},stop:function(a,c){b.dragScroll(!0)}})},initRowGridVisualDrag:function(){var a=this;c.toolbar.$el.find(".tb_row_grid").ThemifyDraggable({iframe:"#themify_builder_site_canvas_iframe",dropitems:".themify_module_holder, .module_row",append:!1,onDragStart:function(a,d){c.toolbar.common.btn.hide()},onDrop:function(b,c,g){e(document).trigger("tb_setpremaderows",[c.data("slug"),
function(b){g.hasClass("themify_module_holder")?a.subRowDrop(b,c):a.rowDrop(b,c)}])}})},initRowVisualDrag:function(){var a=this;c.toolbar.$el.find(".predesigned_row, .dragable_library_item_row").ThemifyDraggable({iframe:"#themify_builder_site_canvas_iframe",dropitems:".module_row",append:!1,onDragStart:function(a,d){c.toolbar.common.btn.hide();d.data("type")},onDragEnd:function(a,c){},onDrop:function(b,d,g){"library_item"==d.data("type")?(d.css({visibility:"hidden"}),b=c.toolbar.libraryItems.get(d.data("main"),
d.data("id")),b.raw&&(Array.isArray(b.raw)?a.rowDrop(b.raw,d):a.rowDrop(Array(b.raw),d))):e(document).trigger("tb_setpredesignedrows",[d.data("slug"),function(b){a.rowDrop(b,d)}])}})},subRowDrop:function(a,b){if(b.closest(".sub_column").length)b.closest(".module_subrow").find('.themify_builder_grid_list [data-col="'+b.data("slug")+'"]').first().trigger("click");else{var d=c.Views.init_subrow(a,c.mode);b.parent().hasClass("themify_module_holder")?b[0].parentNode.replaceChild(d.view.render().el,b[0]):
b.prev().hasClass("themify_module_holder")?b.parent().find("> .themify_module_holder").append(d.view.render().$el):b.parent().find("> .themify_module_holder").prepend(d.view.render().$el);for(var g=a[0].cols.length,f,e=0;e<g;++e)f="",0===e&&(f="first "),e===g-1&&(f="last "),c.Utils._addNewColumn({newclass:f+a[0].cols[e].grid_class,component:"sub-column",type:c.mode},d.view.$el.find(".subrow_inner"));d.view.$el.find('ul.themify_builder_grid_list li a[data-col="'+g+'"]').first().parent().addClass("selected");
c.Mixins.Builder.updateModuleSort(d.view.$el);c.Utils.setCompactMode(d.view.el.getElementsByClassName("module_column"))}b.remove()},rowDrop:function(a,b){function d(){var a=b.prev(".module_row"),d=b.closest(".themify_builder_content").data("postid"),a=0===a.length?!1:a.data("cid");b[0].innerHTML="";b[0].parentNode.replaceChild(g,b[0]);c.saveCid=!1;c.rowStyling=[];c.vent.trigger("dom:change","","","","predesign",{prev:a,rows:f,bid:d});a=0;for(d=f.length;a<d;++a){c.Mixins.Builder.update(f[a]);var e=
f[a].find(".module_column").length;f[a].find('ul.themify_builder_grid_list li a[data-col="'+e+'"]').first().parent().addClass("selected")}ThemifyBuilderCommon.showLoader("hide");c.Utils.setCompactMode(k.view.el.getElementsByClassName("module_column"))}var g=document.createDocumentFragment(),f=[];c.saveCid=!0;for(var e in a)if(a[e].cols&&(0<Object.keys(a[e].cols).length||a[e].cols[0].styling&&0<Object.keys(a[e].cols[0].styling).length)||a[e].styling&&0<Object.keys(a[e].styling).length){var k=c.Views.init_row(a[e],
c.mode);if(!1!==k){var l=k.view.render();g.appendChild(l.el);f.push(l.$el)}}"visual"===c.mode?c.bootstrap(c.rowStyling,d):d()},moduleDrop:function(a,b){function d(d){m.model.set({is_new:1},{silent:!0});d=!0===d?m.model.getPreviewSettings():m.model.get("mod_settings");b?b.append(q.el):(a.replaceWith(q.el),c.Mixins.Builder.update(q.$el));k?c.activeModel=m.model:m.view.trigger("edit",null);c.hasChanged=!0;if("visual"===c.mode&&1<Object.keys(d).length)if("ajax"===a.data("type")||"ajax"===themifyBuilder.modules[m.model.get("mod_name")].type||
"parts"===n){var f=!0;m.model.trigger("custom:preview:refresh",d)}else m.model.trigger("custom:preview:live",d);if(k){if(f){var e=m.view.$el.find(".tb-preview-component").detach();setTimeout(function(){m.view.$el.prepend(e)},50)}g=m.view.$el.closest(".module_row");c.vent.trigger("dom:change",g.data("cid"),l,g,"row")}}var g,f=this;if(a.hasClass("tb_row_grid"))e(document).trigger("tb_setpremaderows",[a.data("slug"),function(b){f.subRowDrop(b,a)}]);else{var h={mod_name:a.data("module-slug")},k=!1;if("library_item"===
a.data("type")){k=!0;h=c.toolbar.libraryItems.get(a.data("main"),a.data("id")).raw;var l=ThemifyBuilderCommon.Lightbox.clone(a.closest(".module_row"))}else c.toolbar.Panel.hide();var m=c.Views.init_module(h,c.mode),q=m.view.render(),n=a.data("main");"visual"===c.mode&&"library_item"===a.data("type")?(h=[],h[m.model.cid]=1,c.bootstrap(h,d)):d(!0)}},newRowAvailable:function(){var a=this.$el.children(".module_row");if(0===a.length||0<a.last().find(".active_module").length)a=c.Views.init_row({cols:[{grid_class:"col-full"}]},
this.type).view.render().$el,a.appendTo(this.$el),e("#sortable").data("sortable")?this.$el.sortable(this.$el.sortable("option")):this.$el.sortable(this.rowSortable),c.Mixins.Builder.updateModuleSort(a),"visual"===c.mode&&"desktop"!==c.activeBreakPoint&&e("body",top_iframe).height(document.body.scrollHeight)},toJSON:function(){for(var a={},b=this.el.getElementsByClassName("module_row"),d=0,g=b.length;d<g;++d)a[d]=c.Utils._getRowSettings(b[d],d);return a}};c.Forms={Data:{},Validators:{},bindEvents:function(){e("body",
top_iframe).on("true"===themifyBuilder.isTouch?"touchend":"click",".builder_save_button",this.saveComponent).on("click","#themify_builder_lightbox_parent .add_new a",this.moduleOptAddRow).on("click","#builder_submit_import_form",this.builderImportSubmit).on("click",".tb-lightbox-switcher a",this.lightbox_switcher).on("click",".layout_preview img",this.templateSelected).on("click","#builder_submit_layout_form",this.saveAsLayout).on("click","#builder_submit_library_item_form",this.saveAsLibraryItem).on("keypress",
"#tb_library_item_form input",this.saveAsLibraryItem);e("body").on("themify_builder_lightbox_close",this.clear);this.widget_actions()},getFormTemplates:function(){function a(a){var b="";if("string"===typeof a)b=a;else for(var c in a)b+=a[c];document.getElementsByTagName("body")[0].insertAdjacentHTML("beforeend",b)}var b=function(){if(themifyBuilder.debug)return!1;try{var a=localStorage.getItem("tb_form_templates"),b="";if(!a)return!1;var a=JSON.parse(a),c;for(c in themifyBuilder.modules)b+=c;return a.ver.toString()!==
tbLocalScript.version.toString()||a.h!==Themify.hash(b)?!1:a.val}catch(h){}return!1}();b?a(b):e.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{action:"tb_load_form_templates",tb_load_nonce:themifyBuilder.tb_load_nonce},success:function(b){if(b){a(b);b=b.replace(/\s\s+/g," ");try{var c="",d;for(d in themifyBuilder.modules)c+=d;var e={val:b,ver:tbLocalScript.version,h:Themify.hash(c)};localStorage.setItem("tb_form_templates",JSON.stringify(e))}catch(k){}}}})},parseSettings:function(a,b,c,g){var d=
!1,h=e(a),k=a.classList,l="",m=!0;g?l=h.data("input-id"):(l=a.getAttribute("name"))||(l=a.getAttribute("id"));if(k.contains("tb_lb_wp_editor"))void 0!==tinyMCE?(d=a.getAttribute("id"),a=tinyMCE.get(d),d=null!==a?!1===a.hidden?a.getContent():switchEditors.wpautop(tinymce.DOM.get(d).value):h.val()):d=h.val();else if(k.contains("themify-checkbox")){var q=[];h.find(".tb-checkbox:checked").each(function(a){q.push(e(this).val())});d=0<q.length?q.join("|"):!1;q=null;m=!1}else if(k.contains("themify-layout-icon"))d=
h.find(".selected").prop("id");else if(k.contains("themify-option-query-cat"))a=h.parent(),d=a.find(".query_category_single"),a=a.find(".query_category_multiple"),d=a.val()?a.val()+"|multiple":d.val()+"|single";else if(k.contains("themify_builder_row_js_wrapper"))for(d=[],a=a.getElementsByClassName("tb_repeatable_field_content"),g=0,k=a.length;g<k;++g){var n=a[g].getElementsByClassName("tb_lb_option_child");d[g]={};for(var w=0,v=n.length;w<v;++w){var p=this.parseSettings(n[w],b,c,!0);p&&"px"!==p.v&&
"pixels"!==p.v&&"solid"!==p.v&&"default"!==p.v&&"|"!==p.v&&(d[g][p.id]=p.v)}}else k.contains("tb-radio-input-container")?(m=h.find("input:checked"),"desktop"!==c&&m.hasClass("reponive_disable")||(d=m.val()),m=!1):k.contains("module-widget-form-container")?d=h.find(":input").themifySerializeObject():(d=h.val(),a=h.attr("data-opacity"),void 0!==a&&""!==a&&1!=a&&"0.99"!==a&&(d+="_"+a));if(d||!b)if(!b||b&&"px"!==d&&"pixels"!==d&&"solid"!==d&&"linear"!==d&&"default"!==d&&"|"!==d&&("desktop"===c||0===h.closest(".reponive_disable").length))return b||
!1!==d||(d=""),{id:l,v:d,checked:m};return!1},serialize:function(a,b,d){d=d||c.activeBreakPoint;var g=void 0!==b;void 0===this.breakpoints&&"desktop"!==d&&g&&(this.breakpoints=Object.keys(themifyBuilder.breakpoints).reverse());var e={};a=top_iframe.getElementById(a).getElementsByClassName("tb_lb_option");var h="desktop"!==d&&g&&void 0!==this.breakpoints?this.breakpoints:!1;if(!1!==h){for(var k=h.indexOf(d),l=0;l<=k;++l)h.shift();h.push("desktop")}l=0;for(k=a.length;l<k;++l){var m=this.parseSettings(a[l],
g,d,!1);if(!1!==m){if(!1!==h&&!0===m.checked&&"SELECT"!==a[l].tagName){for(var q=!1,n=0,w=h.length;n<w;++n)if(void 0!==b["breakpoint_"+h[n]]&&void 0!==b["breakpoint_"+h[n]][m.id]&&b["breakpoint_"+h[n]][m.id]===m.v){q=!0;break}else if("desktop"===h[n]&&void 0!==b[m.id]&&b[m.id]===m.v){q=!0;break}if(q)continue}e[m.id]=m.v}}return e},saveComponent:function(a){var b=null===a;b||a.preventDefault();if(c.hasChanged){var d=c.Forms,g=c.activeModel.get("elType");a="module"===g;if(!a||d.isValidate(e("#tb_module_settings",
top_iframe))){e("body").trigger("themify_builder_save_component");"visual"===c.mode&&window.parent.jQuery("body").trigger("themify_builder_save_component");c.saving=!0;var f={},h=null,k=!1,l=!1,m=null,q=null,n=!1,w="styling",v=e(".tb_element_cid_"+c.activeModel.cid);if(a||"row"===g)a&&(w="mod_settings",k=c.activeModel.get("is_new"),c.activeModel.unset("is_new",{silent:!0})),q=d.serialize("themify_builder_options_setting"),h=d.serialize("themify_builder_options_animation"),m=d.serialize("themify_builder_options_visibility"),
"visual"===c.mode&&("hide_all"===m.visibility_all||"hide"===m.visibility_desktop||"hide"===m.visibility_tablet||"hide"===m.visibility_mobile?v.addClass("tb_visibility_hidden"):v.removeClass("tb_visibility_hidden"));"visual"===c.mode&&c.liveStylingInstance.remember(c.activeModel.cid);b?e("body").trigger("themify_builder_lightbox_before_close"):ThemifyBuilderCommon.Lightbox.close(b);var d=e.extend(!0,{},c.Mixins.Common.styleData),g=e.extend(!0,{},c.activeModel.get(w)),p=d.breakpoint_desktop;delete d.breakpoint_desktop;
for(var x in d)p[x]=d[x];f[w]=e.extend(!0,p,q,h,m);f[w]=c.Utils.clear(f[w]);c.activeModel.set(f,{silent:!0});a&&(k&&(l=ThemifyBuilderCommon.Lightbox.clone(v.closest(".module_column"))),c.vent.trigger("dom:builder:change"),e(".tb-import-layout-button").remove());if("visual"===c.mode){var u=c.liveStylingInstance.getRememberedStyles();void 0===c.isComponentSaved[c.activeModel.cid]&&(c.isComponentSaved[c.activeModel.cid]=1,n=!0)}c.vent.trigger("dom:change",c.activeModel.cid,c.beforeEvent,v,"save",{old:g,
"new":f[w],styles:u,column:l,first:n});c.beforeEvent=!1;c.saving=!1;b&&ThemifyBuilderCommon.Lightbox.close(b)}}else ThemifyBuilderCommon.Lightbox.close(b)},moduleOptAddRow:function(a,b){a.preventDefault();var d=e(a.currentTarget).parent().prev(),g=c.cache.repeaterElements[d.prop("id")].clone(),f=Math.random().toString(36).substr(2,7),h=[],k=!1,l=!1,m=!a.isTrigger||b;g.removeClass("collapsed").find(".row_inner").show();var q=g[0].getElementsByClassName("tb_lb_option_child");b=b?e(b):!1;for(var n=0,
w=q.length;n<w;++n){var v=e(q[n]);var p=b?b.find('[data-input-id="'+v.data("input-id")+'"]'):!1;var x=q[n].classList;if(x.contains("tb_lb_wp_editor")){var u=v.data("input-id");var r=v.data("control-repeater");var D=v.closest(".wp-editor-wrap");v=u+"_"+n+"_"+Math.random().toString(36).substr(2,7);!1===k&&(k=D[0].innerHTML);D[0].innerHTML=k.replace(new RegExp(u,"g"),v);v=D.find(".tb_lb_wp_editor");v.attr({name:u,"data-input-id":u,"data-control-repeater":r}).data({"input-id":u,"control-repeater":r});
p?(p=p.prop("id"),D=tinyMCE.get(p),p=!1===D.hidden?D.getContent():switchEditors.wpautop(tinymce.DOM.get(p).value),v.val(p)):v.val("");h.push(v)}else if(x.contains("themify-layout-icon"))D=v.find("a"),D.removeClass("selected"),p?D.filter("#"+p.find(".selected").prop("id")).addClass("selected"):(p=themifyBuilder.modules[c.activeModel.get("mod_name")],void 0!==p&&void 0!==p.defaults&&p.defaults[u]?D.filter("#"+p.defaults[u]).addClass("selected"):D.first().addClass("selected"));else if(x.contains("themify-builder-uploader-input"))m&&
(l=!0,p=!1!==p?p.val():"",D=v.val(p).parent(),r=D.find(".thumb_preview").find(".img-placeholder"),D.find(".tb-upload-btn").prop("id","pluploader_"+f+"_"+n+"themify-builder-plupload-upload-ui").addClass("plupload-clone").find(".builder_button").prop("id","pluploader_"+f+"_"+n+"themify-builder-plupload-browse-button"),""!==p&&(p=e("<img/>",{src:p,width:50,height:50}),r.html(p)));else if(x.contains("tb-radio-input-container")){D=q[n].getElementsByClassName("themify-builder-radio-dnd");r=v.data("input-id");
var B=p?p.find(":checked").val():!1;p=0;for(var z=D.length;p<z;++p){var A=e(D[p]);A.prop({name:r+"_"+f,id:r+"_"+f+"_"+p,checked:!1}).next("label").prop("for",r+"_"+f+"_"+p);(B===A.val()||!B&&A.data("checked"))&&A.prop("checked",!0)}x.contains("tb-option-radio-enable")&&ThemifyBuilderCommon.Lightbox.clickRadioOption(null,v.find(":checked"))}else B=p?p.val():"",void 0===B&&(B=""),v.val(B);m&&(v.data("binding")&&c.Mixins.Common.doTheBinding(v,B,g),!v.data("control-binding")||x.contains("tb_lb_wp_editor")||
x.contains("minicolors-input")||x.contains("themify-gradient")||c.Views.init_control(v.data("control-type"),{el:v,binding_type:v.data("control-binding"),selector:v.data("live-selector")}))}m&&setTimeout(function(){c.Utils.setColorPicker(g)},1);d[0].appendChild(g[0]);m&&(0<h.length&&setTimeout(function(){for(var a=0,b=h.length;a<b;++a)c.Views.init_control("wp_editor",{el:h[a],binding_type:h[a].data("control-binding"),selector:h[a].data("live-selector")});h=null},1),l&&c.Utils.builderPlupload("new_elemn"))},
builderImportSubmit:function(a){a.preventDefault();var b=e(this);ThemifyBuilderCommon.LiteLightbox.confirm(themifyBuilder.i18n.dialog_import_page_post,function(a){e.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"builder_import_submit",nonce:themifyBuilder.tb_load_nonce,data:b.closest("form").serialize(),importType:"no"===a?"replace":"append",importTo:themifyBuilder.post_ID},beforeSend:function(a){ThemifyBuilderCommon.showLoader("show")},success:function(a){c.Forms.reLoad(a,
themifyBuilder.post_ID);ThemifyBuilderCommon.Lightbox.close()}})},{buttons:{no:{label:"Replace Existing Builder"},yes:{label:"Append Existing Builder"}}})},lightbox_switcher:function(a){a.preventDefault();a=e(a.currentTarget).attr("href").replace("#","");c.activeModel&&"visual"===c.mode&&(c.scrollTo=c.liveStylingInstance.$liveStyledElmt);e(".tb_breakpoint_switcher.breakpoint-"+a,top_iframe).trigger("click")},reLoad:function(a,b){function d(){"visual"===c.mode&&(c.Utils.loadContentJs(),c.id=!1);c.vent.trigger("dom:builder:init");
ThemifyBuilderCommon.showLoader("hide");"visual"===c.mode&&"desktop"!==c.activeBreakPoint&&(e("body",top_iframe).height(document.body.scrollHeight),setTimeout(function(){e("body",top_iframe).height(document.body.scrollHeight)},2E3))}c.Models.Registry.destroy();c.Instances.Builder={};var g="";if("visual"===c.mode){var f="themify-builder-"+b+"-generated-css",h=e("link#"+f),g="#themify_builder_content-"+b;c.id=b;h.remove();void 0!==a.css&&void 0!==a.css.css_file&&(f="<link id="+f+' type="text/css" rel="stylesheet" href="'+
a.css.css_file+"?tmp="+Date.now()+'" />',document.getElementById("themify-builder-admin-ui-css").insertAdjacentHTML("afterend",f));c.VisualCache=[];c.editing=!1;c.isComponentSaved=[];setTimeout(function(){c.liveStylingInstance.reset()},1);e("body").addClass("sidebar-none full_width")}else g="#themify_builder_row_wrapper";c.Instances.Builder[0]=new c.Views.Builder({el:g,collection:new c.Collections.Rows(a.builder_data),type:"visual"});c.Instances.Builder[0].render();c.toolbar.undoManager.reset();"visual"===
c.mode?c.bootstrap(null,d):d()},templateSelected:function(a){a.preventDefault();a.stopPropagation();var b=e(this).closest(".layout_preview");ThemifyBuilderCommon.LiteLightbox.confirm(themifyBuilder.i18n.confirm_template_selected,function(a){var d=themifyBuilder.post_ID,f={type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_set_layout",mode:"no"===a?1:0,nonce:themifyBuilder.tb_load_nonce,layout_slug:b.data("slug"),id:d,layout_group:b.data("group")},beforeSend:function(){"visual"===
c.mode&&ThemifyBuilderCommon.showLoader("show")},success:function(a){ThemifyBuilderCommon.Lightbox.close();"success"===a.status?c.Forms.reLoad(a,d):(ThemifyBuilderCommon.showLoader("error"),alert(a.msg))}};if("pre-designed"===b.data("group")){ThemifyBuilderCommon.showLoader("show");var h=b.data("slug"),k="https://themify.me/themify-layouts/"+h+".txt",l=function(){f.data.builder_data=c.layouts_selected[h];e.ajax(f)};if(!c.layouts_selected)c.layouts_selected={};else if(c.layouts_selected[h]){l();return}e.get(k,
null,null,"text").done(function(a){c.layouts_selected[h]=a;l()}).fail(function(a,b,c){ThemifyBuilderCommon.LiteLightbox.alert("There was an error in loading layout, please try again later, or you can download this file: ("+k+") and then import manually (http://themify.me/docs/builder#import-export).")}).always(function(){ThemifyBuilderCommon.showLoader()})}else e.ajax(f)},{buttons:{no:{label:"Replace Existing Layout"},yes:{label:"Append Existing Layout"}}})},saveAsLayout:function(a){a.preventDefault();
e.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_save_custom_layout",nonce:themifyBuilder.tb_load_nonce,form_data:e("#tb_save_layout_form",top_iframe).serialize()},success:function(a){"success"===a.status?ThemifyBuilderCommon.Lightbox.close():alert(a.msg)}})},saveAsLibraryItem:function(a){if("keypress"!=a.type||13==a.keyCode)a.preventDefault(),e.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_save_custom_item",nonce:themifyBuilder.tb_load_nonce,
form_data:e("#tb_library_item_form",top_iframe).serialize()},success:function(a){if("success"===a.status){c.toolbar.libraryItems.is_init=!1;ThemifyBuilderCommon.Lightbox.close();var b=e("#tb_module_panel.tb_modules_panel_wrap",top_iframe);b.find(".tb_module_panel_search_text").val("");e(document).trigger("change:tab:tb_module_panel_library_wrap",b);if(!_.isUndefined(a.opt)){var b=e("#tmpl-builder_form_layout-part"),g=e("<div />").html(b.html());g.find("#selected_layout_part").html(a.opt);b[0].innerHTML=
g.html()}if(!_.isUndefined(a.model)){var b=function(){f.replaceWith(h.el);k.trigger("custom:preview:refresh",k.get("mod_settings"))},f=e("div[data-cid='"+a.model+"']"),g=[];if(f.hasClass("themify_builder_row")){a=c.Views.init_row(a.replWith,c.mode);var h=a.view.render();a=h.$el.find(".active_module").data("cid");var k=c.Models.Registry.lookup(a)}else k=c.Views.init_module(a.replWith,c.mode),h=k.view.render(),k=k.model;g[k.cid]=1;"visual"==c.mode?c.bootstrap(g,b):b()}}else alert(a.msg)}})},widget_actions:function(){var a=
{},b=!1,d=!1,g=!1;e("body",top_iframe).on("change","#class_widget",function(){var f=e(this).val(),h=e(this).find(" :selected").data("idbase"),k=b["widget-id"],l=function(h,k){var l=e("#instance_widget",top_iframe),m=e(k.form),q=function(a){"text"===a?d||(d=!0,wp.textWidgets.init()):g||(wp.mediaWidgets.init(),g=!0);e(document).trigger("widget-added",[l]);"text"===a&&c.Views.init_control("wp_editor",{el:l.find(".wp-editor-area"),binding_type:"refresh"})},p=function(a,b,c){var d=a.length;(function(a,
b,c){Themify.LoadAsync(a,b,null,null,c)})(a[b],function(){++b;b<d?p(a,b,c):q(c)})};if(b)for(var x in b)m.find('[name="'+x+'"]').val(b[x]);m.find(".widget-id").val(Math.random());m.find("select").wrap('<span class="selectwrapper"/>');l.html(m.html());void 0===a[h]&&k.template?(document.getElementsByTagName("body")[0].insertAdjacentHTML("beforeend",k.template),0<k.src.length&&p(k.src,0,h)):k.init&&q(h,k.form);"visual"===c.mode&&f&&l.find(":input").first().trigger("change")};z.class_widget=f;void 0!==
a[h]&&k===a[h].widgetID?l(h,a[h]):e.ajax({type:"POST",dataType:"json",url:themifyBuilder.ajaxurl,data:{action:"module_widget_get_form",tb_load_nonce:themifyBuilder.tb_load_nonce,load_class:f,tpl_loaded:+(0<e("#tmpl-media-modal").length),id_base:h,widget_instance:b},success:function(b){b&&b.form&&(l(h,b),a[h]={form:b.form,init:0<b.src.length,widgetID:k})}})});e("body").on("editing_module_option",function(a,c,d,g){"widget"===c&&d.instance_widget&&(b=d.instance_widget,setTimeout(function(){e("#class_widget",
g).trigger("change");b=!1},200))})},isValidate:function(a){var b=a.find("[data-validation]");if(0===b.length)return!0;var c=this,g={};b.each(function(){var a=e(this),b=a.data("validation"),d=a.val();c.checkValidate(b,d)||(g[a.prop("id")]=a.data("error-msg"))});a.find(".tb_field_error").removeClass("tb_field_error").end().find(".tb_field_error_msg").remove();if(_.isEmpty(g))return!0;var f=0;_.each(g,function(b,c){var d=a.find("#"+c);d.addClass("tb_field_error");e("<span/>",{"class":"tb_field_error_msg",
"data-error-key":c}).text(b).insertAfter(d);f||(d=a.children().index(d.closest(".themify_builder_options_tab_wrapper")),(d=-1<d&&a.closest("#themify_builder_lightbox_parent").find(".themify_builder_options_tab > li").eq(d))&&!d.hasClass("current")&&d.trigger("click"),f++)});return!1},checkValidate:function(a,b){return c.Forms.get_validator(a)(b)},clear:function(){if(c.activeModel&&(void 0!==c.activeModel.get("is_new")&&c.activeModel.trigger("dom:module:unsaved"),c.activeModel=null,void 0!==tinyMCE))for(var a=
tinymce.editors.length-1;-1<a;a--)"content"!==tinymce.editors[a].id&&tinyMCE.execCommand("mceRemoveEditor",!0,tinymce.editors[a].id)}};c.Forms.register_validator=function(a,b){this.Validators[a]=b};c.Forms.get_validator=function(a){return void 0!==this.Validators[a]?this.Validators[a]:this.Validators.not_empty};c.Forms.register_validator("email",function(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
a=a.split(",");return!(0<e.map(a,function(a,c){return b.test(a)?null:"1"}).length)});c.Forms.register_validator("not_empty",function(a){return!(!a||""===a.trim())});c.Views.Toolbar=Backbone.View.extend({events:{"click .tb_import":"import","click .themify_builder_load_layout":"loadLayout","click .themify_builder_save_layout":"saveLayout","click .themify_builder_dup_link":"duplicate","click .tb_toolbar_save":"save","click .tb_toolbar_backend_edit a":"save","click .tb_toolbar_close_btn":"panelClose",
"click .tb_breakpoint_switcher":"breakpointSwitcher","click .themify_builder_zoom":"zoom","click .tb_toolbar_zoom_menu_toggle":"zoom","click .tb_toolbar_builder_preview":"previewBuilder"},initialize:function(){var a=[],b=this,d=this.$el.find(".tb_module_panel_modules_wrap"),g=wp.template("builder_module_item_draggable"),f;for(f in themifyBuilder.modules)a.push(g({slug:f,name:themifyBuilder.modules[f].name,type:themifyBuilder.modules[f].type?themifyBuilder.modules[f].type:"",favorite:+themifyBuilder.modules[f].favorite}));
d[0].innerHTML=a.join("")+'<span class="favorite-separator"></span>';e("#tmpl-builder_module_item_draggable").remove();"visual"===c.mode&&e("body",top_iframe)[0].appendChild(this.el);a=null;setTimeout(function(){function a(){new SimpleBar(d[0]);b.preDesignedRows.init();b.libraryItems.init();b.common.init()}b.Panel.init();b.undoManager.init();"visual"===c.mode?(window.parent.jQuery("body").one("themify_builder_ready",a),b.unload()):a()},1);setTimeout(function(){b.Revisions.init()},800);e("body",top_iframe).on("click",
".themify_module_favorite",b.toggleFavoriteModule);if("visual"===c.mode)e("body").on("click",".themify_module_favorite",b.toggleFavoriteModule);b.compactToolbar()},compactToolbar:function(){function a(){f&&clearTimeout(f);f=setTimeout(function(){d.toggleClass("compact-toolbar",b.$el.outerWidth()<g)},50)}var b=this,d=e("body",top_iframe),g="visual"===c.mode?850:750,f;window.top.jQuery("body").on("themify_builder_ready",a);e(window.top).on("resize",a);b.$el.find(".tb_toolbar_divider").each(function(){var a=
e(this).nextUntil(".tb_toolbar_divider");if(1<a.length&&!a.eq(0).hasClass("tb_toolbar_compact_item")){var b=a.clone();a.eq(0).addClass("tb_toolbar_compact_item").append('<ul class="tb_compact_group"></ul>').find(".tb_compact_group").append(b)}})},"import":function(a){a.preventDefault();a=ThemifyBuilderCommon.detectBuilderComponent(e(a.currentTarget));var b=null,d={dataType:"html",data:{action:"builder_import",type:a}};if("file"!==a||confirm(themifyBuilder.i18n.importFileConfirm))"file"===a&&(b=function(){c.Utils.builderPlupload("",
!0)}),ThemifyBuilderCommon.Lightbox.open(d,null,b)},unload:function(){var a=this;"visual"===c.mode&&document.getElementsByTagName("head")[0].insertAdjacentHTML("afterbegin",'<base target="_parent">');window.parent.onbeforeunload=function(){return!c.editing&&a.undoManager.hasUndo()?"Are you sure":null}},panelClose:function(a){a.preventDefault();ThemifyBuilderCommon.inLightboxIframe()?(e(".tb_toolbar_backend_edit",highest_iframe).show(),"visual"==c.mode&&(e(".themify_builder_workspace_container",highest_iframe).css({margin:highest_iframe.layoutpart.margin}),
e("body",highest_iframe).removeClass("themify_builder_layoutPart_edit"),e("#tb_toolbar",highest_iframe).show(),highest_iframe.layoutpart.model()),e(window.highest_iframe.layoutpart.overlay).css({backgroundColor:"initial"}).hide().siblings(".tb_layoutpart_lightbox").remove(),e(window.highest_iframe.layoutpart.overlay).remove()):window.parent.location.reload(!0)},undoManager:{stack:[],is_working:!1,index:-1,btnUndo:document.getElementsByClassName("tb-undo-btn")[0],btnRedo:document.getElementsByClassName("tb-redo-btn")[0],
init:function(){var a=this;c.toolbar.$el.find(".tb-undo-redo").on("click",this.do_change.bind(this));if(!themifyBuilder.disableShortcuts&&(e(top_iframe).on("keydown",this.keypres.bind(this)),"visual"===c.mode))e(document).on("keydown",this.keypres.bind(this));c.vent.on("dom:change",function(b,d,g,f,h){c.hasChanged&&(c.editing=!1,g&&(g=ThemifyBuilderCommon.Lightbox.clone(g)),"visual"!==c.mode||"duplicate"!==f&&"sort"!==f||e(window).trigger("tfsmartresize.tfVideo"),a.stack.splice(a.index+1,a.stack.length-
a.index),a.stack.push({cid:b,type:f,data:h,before:d,after:g}),a.index=a.stack.length-1,a.updateUndoBtns(),"visual"===c.mode&&e("body").trigger("builder_dom_changed",[f]))})},set:function(a){var b=a[0].querySelectorAll("[data-cid]"),b=Array.prototype.slice.call(b);b.unshift(a[0]);a=0;for(var d=b.length;a<d;++a){var e=c.Models.Registry.lookup(b[a].getAttribute("data-cid"));e&&e.trigger("change:view",b[a])}},doScroll:function(a){("visual"!==c.mode||"desktop"===c.activeBreakPoint?e("body"):e("body",top_iframe)).scrollTop(a.offset().top)},
keypres:function(a){if(90===a.which&&"INPUT"!==document.activeElement.tagName&&"TEXTAREA"!==document.activeElement.tagName)if(!0===a.ctrlKey&&!0===a.shiftKey||!0===a.metaKey&&!0===a.shiftKey)a.preventDefault(),this.hasRedo()&&this.changes(!1);else if(!0===a.ctrlKey||!0===a.metaKey)a.preventDefault(),this.hasUndo()&&this.changes(!0)},changes:function(a){var b=this.stack[this.index+(a?0:1)];if(void 0!==b){this.is_working=!0;var d="";var g=b.type,f=e(".tb_element_cid_"+b.cid);var h=!1;if("row"===g)a?
(d=b.before.clone(!0),h=b.cid):(d=b.after.clone(!0),h=b.before.data("cid"),f=e(".tb_element_cid_"+h)),this.set(d),f.replaceWith(d);else if("duplicate"===g)a?e(".tb_element_cid_"+b.after.data("cid")).remove():(d=b.after.clone(!0),h=b.before.data("cid"),this.set(d),f.after(d));else if("delete_row"===g)a?(d=b.before.clone(!0),h=b.cid,f=e(".tb_element_cid_"+b.data.pos_cid),this.set(d),"after"===b.data.pos?f.after(d):f.before(d)):f.remove();else if("sort"===g)h=b.cid,a?(f=b.data.after,g=b.data.before,
d=b.before.clone(!0)):(f=b.data.before,g=b.data.after,d=b.after.clone(!0),"visual"===c.mode&&d.find(".active_module").css({display:"block",height:"auto"})),this.set(d),e(".tb_element_cid_"+f).find(".tb_element_cid_"+h).remove(),e(".tb_element_cid_"+g).replaceWith(d);else if("save"===g){h=b.cid;var g=c.Models.Registry.lookup(h),k="module"===g.get("elType"),l={},m=k?"mod_settings":"styling";k&&b.data.column?a?(h=!1,f.remove()):(h=b.data.column.data("cid"),d=b.data.column.clone(!0),f=e(".tb_element_cid_"+
h),this.set(d),f.replaceWith(d)):(a?(l[m]=b.data.old,d=b.before.clone(!0)):(l[m]=b.data["new"],d=b.after.clone(!0)),g.set(l,{silent:!0}),this.set(d),f.replaceWith(d),"visual"===c.mode&&c.liveStylingInstance.doUndo(b.data.styles,a?b.data.first:!1))}else if("predesign"===g)if(f=b.data.rows,a)for(g=0,k=f.length;g<k;++g)e(".tb_element_cid_"+f[g].data("cid")).remove();else{l=document.createDocumentFragment();d=[];g=0;for(k=f.length;g<k;++g)m=ThemifyBuilderCommon.Lightbox.clone(f[g]),l.appendChild(m[0]),
d.push(m);!1!==b.data.prev?e(".tb_element_cid_"+b.data.prev).after(l):e("#themify_builder_content-"+b.data.bid).prepend(l);g=0;for(k=d.length;g<k;++g)this.set(d[g]),c.Mixins.Builder.update(d[g])}else if("import"===g){var f=e('[data-postid="'+b.data.bid+'"]'),b=a?b.data.before.clone(!0):b.data.after.clone(!0),q=this;f.children().remove();f.prepend(b);b.each(function(){q.set(e(this))})}h&&c.Mixins.Builder.update(d);a?this.index--:this.index++;this.is_working=!1;this.updateUndoBtns()}},hasRedo:function(){return this.index<
this.stack.length-1},hasUndo:function(){return-1!==this.index},disable:function(){this.btnUndo.classList.add("tb_disabled");this.btnRedo.classList.add("tb_disabled");this.btnUndo.parentNode.classList.contains("tb_toolbar_compact_item")&&(this.btnUndo.parentNode.querySelector(".tb_compact_group .tb-undo-btn").classList.add("tb_disabled"),this.btnUndo.parentNode.querySelector(".tb_compact_group .tb-redo-btn").classList.add("tb_disabled"))},updateUndoBtns:function(){this.btnUndo.classList.toggle("tb_disabled",
!this.hasUndo());this.btnRedo.classList.toggle("tb_disabled",!this.hasRedo());this.btnUndo.parentNode.classList.contains("tb_toolbar_compact_item")&&(this.btnUndo.parentNode.querySelector(".tb_compact_group .tb-undo-btn").classList.toggle("tb_disabled",!this.hasUndo()),this.btnUndo.parentNode.querySelector(".tb_compact_group .tb-redo-btn").classList.toggle("tb_disabled",!this.hasRedo()))},reset:function(){this.stack=[];this.index=-1;this.updateUndoBtns()},do_change:function(a){a.preventDefault();
!1===this.is_working&&-1===a.currentTarget.className.indexOf("tb_disabled")&&this.changes(-1!==a.currentTarget.className.indexOf("tb-undo-btn"))}},loadLayout:function(a){function b(a){a.each(function(a){0===a%4?e(this).addClass("layout-column-break"):e(this).removeClass("layout-column-break")})}a.preventDefault();var c=this;ThemifyBuilderCommon.Lightbox.open(c.layouts_list?{loadMethod:"html",data:c.layouts_list}:{data:{action:"tb_load_layout"}},null,function(a){function d(){var a=g.find(".layout_preview_list");
k.show().find("a").on("click",function(c){c.preventDefault();e(this).hasClass("selected")||(c=a,e(this).hasClass("all")||(a.hide(),c=a.filter('[data-category*="'+e(this).text()+'"]')),c.show(),b(c),k.find("a").removeClass("selected"),e(this).addClass("selected"),k.parent().find(".tb_filter_layouts").html(e(this).text()))});g.find("#themify_builder_layout_search").on("keyup",function(){var c=e.trim(e(this).val()),d=a;""!==c&&(d=k.find("a.all"),d.hasClass("selected")||d.click(),a.hide(),d=a.find(".layout_title:contains("+
c+")").closest(".layout_preview_list"));d.show();b(d)})}a=e(a);var g=a.find("#themify_builder_tabs_pre-designed"),k=g.find("#themify_builder_pre-designed-filter");0!=g.length&&(c.layouts_list?d():(ThemifyBuilderCommon.showLoader("show"),e.getJSON("https://themify.me/themify-layouts/index.json").done(function(f){var h=window.parent.wp.template("themify-builder-layout-item"),l={},n="";f=e(h(f));f.find("li").each(function(){for(var a=e(this).data("category").split(","),b=0,c=a.length;b<c;++b)""!==a[b]&&
void 0===l[a[b]]&&(n+='<li><a href="#">'+a[b]+"</a></li>",l[a[b]]=1)});l=null;k[0].insertAdjacentHTML("beforeend",n);g[0].insertAdjacentHTML("beforeend",f[0].outerHTML);a.find(".themify_builder_tab").each(function(){b(e(this).find(".layout_preview_list"))});c.layouts_list=a[0];d();new SimpleBar(a[0])}).fail(function(a,b,c){ThemifyBuilderCommon.LiteLightbox.alert(e("#themify_builder_load_layout_error",g).show().text())}).always(function(){ThemifyBuilderCommon.showLoader("spinhide")})))})},saveLayout:function(a){a.preventDefault();
ThemifyBuilderCommon.Lightbox.open({data:{action:"tb_custom_layout_form",postid:themifyBuilder.post_ID}},function(){c.Utils.builderPlupload("normal")})},duplicate:function(a){function b(){d.Revisions.ajax({action:"tb_duplicate_page",tb_is_admin:"visual"!==c.mode},function(a){a&&(window.parent.location.href=e("<div/>").html(a).text())})}a.preventDefault();var d=this;confirm(themifyBuilder.i18n.confirm_on_duplicate_page)?c.Utils.saveBuilder(b):b()},Revisions:{init:function(){c.toolbar.$el.find(".tb_revision").on("click",
this.revision.bind(this));e("body",top_iframe).on("click",".js-builder-restore-revision-btn",this.restore.bind(this)).on("click",".js-builder-delete-revision-btn",this["delete"].bind(this))},revision:function(a){a.preventDefault();a.currentTarget.classList.contains("tb_save_revision")?this.save():this.load()},load:function(){ThemifyBuilderCommon.Lightbox.open({data:{action:"tb_load_revision_lists",postid:themifyBuilder.post_ID,tb_load_nonce:themifyBuilder.tb_load_nonce}})},ajax:function(a,b){a=e.extend({},
a,{tb_load_nonce:themifyBuilder.tb_load_nonce,postid:themifyBuilder.post_ID});return e.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:a,beforeSend:function(){ThemifyBuilderCommon.showLoader("show")},complete:function(){ThemifyBuilderCommon.showLoader("hide")},success:function(a){e.isFunction(b)&&b.call(this,a)}})},save:function(a){var b=this;ThemifyBuilderCommon.LiteLightbox.prompt(themifyBuilder.i18n.enterRevComment,function(d){null!==d&&c.Utils.saveBuilder(function(){b.ajax({action:"tb_save_revision",
rev_comment:d},a)},"main",0,!0)})},restore:function(a){a.preventDefault();var b=e(a.currentTarget).data("rev-id"),d=this,g=function(){d.ajax({action:"tb_restore_revision_page",revid:b},function(a){a.status?(c.Forms.reLoad(a,themifyBuilder.post_ID),ThemifyBuilderCommon.Lightbox.close()):(ThemifyBuilderCommon.showLoader("error"),alert(a.data))})};ThemifyBuilderCommon.LiteLightbox.confirm(themifyBuilder.i18n.confirmRestoreRev,function(a){"yes"===a?d.save(g):g()},{buttons:{no:{label:"Don't Save"},yes:{label:"Save"}}})},
"delete":function(a){a.preventDefault();if(confirm(themifyBuilder.i18n.confirmDeleteRev)){var b=e(a.currentTarget);a=b.data("rev-id");this.ajax({action:"tb_delete_revision",revid:a},function(a){a.success?b.closest("li").remove():(ThemifyBuilderCommon.showLoader("error"),alert(a.data))})}}},save:function(a){a.preventDefault();a.stopPropagation();var b=0<e(a.currentTarget).closest(".tb_toolbar_backend_edit").length?e(a.currentTarget).prop("href"):!1;c.Utils.saveBuilder(function(a,e){"success"!==e?alert(themifyBuilder.i18n.errorSaveBuilder):
!1!==b&&("visual"===c.mode?(sessionStorage.setItem("focusBackendEditor",!0),window.parent.location.href=b):(c.toolbar.undoManager.reset(),c._backendSwitchFrontend()))})},libraryItems:{is_init:null,items:[],subTab_toolbar:null,init:function(){e(document).on("change:tab:tb_module_panel_library_wrap",this.load.bind(this));c.toolbar.common.subTab_btn=this.subTab_toolbar=c.toolbar.$el.find("ul.tb_library_types li.active a").data("type")},get:function(a,b){return _.isUndefined(this.items[b])||this.items[b].type!=
a?!1:this.items[b].data},load:function(a,b,d){if(!this.is_init){b=e(b);var g=this;e.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{action:"tb_get_library_items",nonce:themifyBuilder.tb_load_nonce,pid:themifyBuilder.post_ID},beforeSend:function(a){b.addClass("tb_busy")},success:function(a){g.setData(g.subTab_toolbar,a,b,d);b.removeClass("tb_busy")},error:function(){b.removeClass("tb_busy");ThemifyBuilderCommon.showLoader("error");this.is_init=!1;c.toolbar.$el.find(".tb_library_item_list").html("<h3>Failed to load Library Items.</h3>")}})}},
setData:function(a,b,d,g){if(!this.is_init){a='<span id="no-content" style="display:none">No library content found.</span>';d=c.toolbar.$el.find(".tb_library_item_list");b="string"===typeof b?JSON.parse(b):b;if("object"===typeof b||"array"===typeof b){this.items=[];for(var f=0,h=b.length;f<h;++f)this.items.push({type:b[f].type,data:b[f]}),a+='<div class="dragable_library_item dragable_library_item_'+b[f].type+'" data-id="'+f+'" data-type="library_item" data-main="'+b[f].type+'">',a+='<div class="dragable_library_item_inner"><span>'+
b[f].title+"</span>",a+='<a href="#" class="remove_item_btn" title="Delete" ondragstart="return false;"></a></div></div>'}d[0].innerHTML=a;new SimpleBar(d[0]);this.set_subTab();this.change(this.subTab_toolbar,c.toolbar.$el);e(document).trigger("update:tb_btn","tb_module_panel_library_wrap",g);this.is_init=!0;c.toolbar.common.library_load=!0}},change:function(a,b){b.find(".dragable_library_item, #no-content").hide();0<b.find(".dragable_library_item_"+a).length?b.find(".dragable_library_item_"+a).show():
b.find("#no-content").show()},set_subTab:function(a){function b(a){a.preventDefault();a.stopPropagation();var b=e(a.currentTarget),d=b.data("type"),f=b.closest("#tb_plus_btn_popover.tb_modules_panel_wrap");0>=f.length&&(f=e(a.target,top_iframe).closest("#tb_module_panel.tb_modules_panel_wrap"));f.find(".tb_module_panel_search_text").val("");b.closest("li").addClass("active").siblings().removeClass("active");"tb_module_panel"===f.prop("id")?g.subTab_toolbar=d:c.toolbar.common.subTab_btn=d;g.is_init?
g.change(d,f):e(document).trigger("change:tab:tb_module_panel_library_wrap",f)}function d(a){g["delete"](a,g)}var g=this;"btn"==a?(c.toolbar.common.btn.find(".tb_library_types").off("click","a").on("click","a",b.bind(this)),c.toolbar.common.btn.find("a.remove_item_btn").off("click").on("click",d.bind(this))):(c.toolbar.$el.find(".tb_library_types").off("click","a").on("click","a",b.bind(this)),c.toolbar.$el.find("a.remove_item_btn").off("click").on("click",d.bind(this)))},"delete":function(a,b){a.preventDefault();
a.stopPropagation();var d=e(a.target).closest(".dragable_library_item"),g=b.items[d.data("id")].type,f=e(a.target).closest("#tb_plus_btn_popover.tb_modules_panel_wrap");0>=f.length&&(f=e(a.target,top_iframe).closest("#tb_module_panel.tb_modules_panel_wrap"));b.items&&!_.isUndefined(b.items[d.data("id")])&&confirm(themifyBuilder.i18n[g+"LibraryDeleteConfirm"])&&e.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{action:"tb_remove_library_item",nonce:themifyBuilder.tb_load_nonce,pid:b.items[d.data("id")].data.pid},
beforeSend:function(a){ThemifyBuilderCommon.showLoader("show")},success:function(a){b.is_init=!1;if(!_.isUndefined(a.opt)){var d=e("#tmpl-builder_form_layout-part"),g=e("<div />").html(d.html());g.find("#selected_layout_part").html(a.opt);d[0].innerHTML=g.html();var d=c.Models.Registry.items,h;for(h in d)"module"==d[h].get("elType")&&"layout-part"==d[h].get("mod_name")&&a.part==d[h].get("mod_settings").selected_layout_part&&d[h].destroy()}ThemifyBuilderCommon.showLoader("hide");c.toolbar.$el.find(".tb_library_item_list").empty();
e(document).trigger("change:tab:tb_module_panel_library_wrap",f)},error:function(){ThemifyBuilderCommon.showLoader("error")}})}},preDesignedRows:{is_init:null,rows:{},filter_toolbar:null,init:function(){setTimeout(function(){document.getElementsByTagName("head")[0].insertAdjacentHTML("afterbegin",'<meta http-equiv="x-dns-prefetch-control" content="on"/><link href="//themify.me" rel="dns-prefetch preconnect"/><link href="//fonts.googleapis.com" rel="dns-prefetch"/><link href="//maps.google.com" rel="dns-prefetch"/><link href="https://themify.me/public-api/predesigned-rows/index.json" rel="prefetch"/>')},
7E3);e(document).on("tb_setpredesignedrows",this.get.bind(this));e(document).on("tb_setpremaderows",this.grid.bind(this));e(document).on("change:tab:tb_module_panel_rows_wrap",this.load.bind(this))},load:function(a,b,d){if(null===this.is_init){this.is_init=!0;var g=this;b=e(b);b.addClass("tb_busy");e.getJSON("https://themify.me/public-api/predesigned-rows/index.json").done(function(a){g.setData(a,b,d)}).fail(function(a,e,k){g.setData({},b,d);this.is_init=null;ThemifyBuilderCommon.showLoader("error");
c.toolbar.$el.find(".tb_predesigned_rows_list").append("<h3>Failed to load Pre-Designed Rows from server.</h3>")})}},setData:function(a,b,d){function g(){x.filter();b.removeClass("tb_busy");new SimpleBar(p[0]);e(document).trigger("update:tb_btn","tb_module_panel_rows_wrap",d);c.toolbar.common.preDesign_load=!0}for(var f=[],h="",k="",l=0,m=a.length;l<m;++l){for(var q=a[l].category.split(","),n="",w=0,v=q.length;w<v;++w)-1===f.indexOf(q[w])&&f.push(q[w]),n+=" tb"+Themify.hash(q[w]);if(void 0===a[l].thumbnail||
""===a[l].thumbnail)a[l].thumbnail="https://placeholdit.imgix.net/~text?txtsize=24&txt="+encodeURI(a[l].title)+"&w=181&h=77";k+='<div class="predesigned_row'+n+'" data-slug="'+a[l].slug+'"><figure class="tb_predesigned_rows_list_image">';k+='<img alt="'+a[l].title+'" title="'+a[l].title+'" src="'+a[l].thumbnail+'" /></figure>';k+='<div class="tb_predesigned_rows_list_title">'+a[l].title+"</div></div>"}a=null;f.sort();f.unshift("Empty Rows");l=0;for(m=f.length;l<m;++l)a="Empty Rows"!=f[l]?Themify.hash(f[l]):
"-empty-rows",h+='<li><a href="#" data-slug="'+a+'">'+f[l]+"</li>";c.toolbar.$el.find(".tb_row_filter")[0].insertAdjacentHTML("beforeend",h);var p=c.toolbar.$el.find(".tb_predesigned_rows_list");p[0].insertAdjacentHTML("beforeend",k);var x=this;if(p.find("img").length)p.find("img").last().one("load",function(){g()});else g()},grid:function(a,b,c){a=[];if(1==b)a.push({grid_class:"col-full"});else for(var d=0;d<b;d++)a.push({column_order:d,grid_class:"col"+b+"-1"});c([{row_order:"0",cols:a}])},get:function(a,
b,c){ThemifyBuilderCommon.showLoader("show");if(void 0!==this.rows[b])"function"===typeof c&&c(this.rows[b]);else{var d=this;e.getJSON("https://themify.me/public-api/predesigned-rows/"+b+".txt").done(function(a){d.rows[b]=a;"function"===typeof c&&c(a)}).fail(function(a,b,c){ThemifyBuilderCommon.showLoader("error");alert("Failed to fetch row template")})}},filter:function(){function a(a){a.preventDefault();a.stopPropagation();a=e(a.currentTarget);var b=a.data("slug"),g=a.closest(".tb_modules_panel_wrap"),
f=g.find(".tb_row_filter_active"),h=g.find(".predesigned_row");f.text(a.text());g.find(".tb_module_panel_search_text").val("");if(b){var k="tb"+b;h.each(function(){e(this).hasClass(k)?e(this).show():e(this).hide()})}else h.show();"tb_module_panel"===g.prop("id")?this.filter_toolbar=k:c.toolbar.common.filter_btn=k}c.toolbar.$el.find(".tb_row_filter").on("click","a",a.bind(this));setTimeout(function(){c.toolbar.common.btn.find(".tb_row_filter").on("click","a",a.bind(this))},100)}},common:{btn:null,
clicked:null,filter_btn:null,preDesign_load:!1,library_load:!1,subTab_btn:"",init:function(){this.btn=e('<div class="tb_modules_panel_wrap" id="tb_plus_btn_popover"></div>');e("body").append(this.btn);var a=this;this.btn.on("click",".add_module_btn",function(b){c.toolbar.Panel.add_module(b,a.clicked.closest(".module_row").find(".themify_module_holder").last());a.clicked=null;a.btn.hide()}).on("keyup",".tb_module_panel_search_text",this.search.bind(this));c.toolbar.$el.find(".tb_module_panel_search_text").on("keyup",
this.search.bind(this));if("visual"===c.mode)c.toolbar.$el.find(".tb_module_types a").on("click",this.tabs.bind(this));e("body").on("click",".tb_module_types a",this.tabs.bind(this)).on("click",".tb_row_btn_plus",this.show.bind(this));e(document).on("update:tb_btn",this.btnData.bind(this));this.firstRun()},firstRun:function(){var a=c.toolbar.$el.find("#tb_module_panel");this.btn[0].insertAdjacentHTML("beforeend",a[0].innerHTML);this.btn.find(".tb_module_panel_lock").remove();this.btn.find(".themify_builder_module_outer").show();
this.btn.find(".tb_module_panel_search_text").val("");new SimpleBar(this.btn.find(".tb_module_panel_modules_wrap")[0]);c.Mixins.Builder.initModuleDraggable(this.btn)},btnData:function(a,b,d){a=c.toolbar.$el.find("."+b);this.btn.find("."+b).html(a.html());this.btn.find(".tb_module_panel_lock").remove();this.btn.find(".themify_builder_module_outer").show();this.btn.find(".tb_module_panel_search_text").val("");"visual"===c.mode?(c.Mixins.Builder.initRowVisualDrag(),c.Mixins.Builder.initRowGridVisualDrag(),
c.Mixins.Builder.initModuleVisualDrag()):(c.Mixins.Builder.initRowDraggable(c.toolbar.$el),c.Mixins.Builder.initGridsDraggable(c.toolbar.$el),c.Mixins.Builder.initModuleDraggable(c.toolbar.$el));c.toolbar.libraryItems.set_subTab("btn");new SimpleBar(this.btn.find("."+b)[0]);c.Mixins.Builder.initModuleDraggable(this.btn);c.Mixins.Builder.initRowDraggable(this.btn);c.Mixins.Builder.initGridsDraggable(this.btn);"function"===typeof d&&d()},tabs:function(a){a.preventDefault();a.stopPropagation();a=e(a.currentTarget);
var b=a.data("target"),c=a.closest(".tb_modules_panel_wrap");e(document).trigger("change:tab:"+b,c);c.find("."+b).show().siblings(".tb_module_panel_tab").hide();a.closest("li").addClass("active").siblings().removeClass("active");c.find(".tb_module_panel_search_text").val("")},show:function(a){function b(){"visual"===c.mode&&"desktop"!==c.activeBreakPoint&&(e("body",top_iframe).height(document.body.scrollHeight+d.btn.outerHeight(!0)),e("body").css("padding-bottom",180))}a.preventDefault();a.stopPropagation();
var d=this;this.clicked=e(a.currentTarget);a=this.clicked.offset();this.btn.css({top:a.top,left:a.left-this.btn.width()/2+11}).show();a=(a=this.btn.find(".tb_module_types .active a").data("target"))?a:c.toolbar.$el.find(".tb_module_types .active a").data("target");e(document).trigger("change:tab:"+a,this.btn,b);null!==this.is_init&&b();this.hide()},hide:function(){function a(d){b.btn.is(":hover")||(b.btn.hide(),b.clicked=null,e(document).off("click",a),e(top_iframe).off("click",a),"visual"===c.mode&&
"desktop"!==c.activeBreakPoint&&(e("body",top_iframe).height(document.body.scrollHeight),e("body").css("padding-bottom","")))}var b=this;if("visual"===c.mode)e(top_iframe).on("click",a);e(document).on("click",a)},search:function(a){a=e(a.currentTarget);var b=a.closest(".tb_modules_panel_wrap"),d="tb_module_panel_modules_wrap"===b.find(".tb_module_types .active a").data("target"),g="tb_module_panel_library_wrap"===b.find(".tb_module_types .active a").data("target"),f="tb_module_panel_rows_wrap"===
b.find(".tb_module_types .active a").data("target"),h=d||g||!c.toolbar.preDesignedRows.is_init?!1:"tb_module_panel"===b.prop("id")?c.toolbar.preDesignedRows.filter_toolbar:this.filter_btn,k=d||f||!c.toolbar.libraryItems.is_init?!1:"tb_module_panel"===b.prop("id")?c.toolbar.libraryItems.subTab_toolbar:this.subTab_btn,b=d?b.find(".themify_builder_module_outer"):c.toolbar.preDesignedRows.is_init&&!g?b.find(".predesigned_row"):c.toolbar.libraryItems.is_init&&g?b.find(".dragable_library_item"):!1;a=e.trim(a.val());
if(!1!==b){var l=""===a,m=l?!1:new RegExp(a,"i");b.each(function(){if(h&&!e(this).hasClass(h)||g&&!e(this).hasClass("dragable_library_item_"+k))return!0;var a=d?e(this).find(".module_name"):g?e(this).find(".dragable_library_item_inner span"):e(this).find(".tb_predesigned_rows_list_title");l||m.test(a.text())?e(this).show():e(this).hide()})}}},breakpointSwitcher:function(a){function b(){g.responsive_grids(f,l);e("body").trigger("themify_builder_change_mode",[l,f]);"visual"===c.mode?(m.css("will-change",
"auto"),c.Mixins.Builder.updateModuleSort(null,"desktop"===f?"enable":"disable"),c.Utils._onResize(!0,function(){g.iframeScroll("desktop"!==f);e("body",top_iframe).height("desktop"!==f?document.body.scrollHeight:"auto");c.scrollTo&&setTimeout(function(){c.scrollTo&&e(window).add(top_iframe).scrollTop(c.scrollTo.offset().top);c.scrollTo=!1},500);setTimeout(function(){c.Utils.setCompactMode(document.getElementsByClassName("module_column"));k.removeClass("tb_start_animate")},200)})):k.removeClass("tb_start_animate");
k.toggleClass("tb_responsive_mode","desktop"!==f).removeClass("builder-breakpoint-"+l).addClass("builder-breakpoint-"+f)}a.preventDefault();if(themifyBuilder.is_premium){var d="",g=this,f="desktop",h=e(a.currentTarget),k=e("body",top_iframe),l=c.activeBreakPoint;h.hasClass("breakpoint-tablet")?f="tablet":h.hasClass("breakpoint-tablet_landscape")?f="tablet_landscape":h.hasClass("breakpoint-mobile")&&(f="mobile");if(l===f&&void 0!==a.originalEvent)return!1;c.activeBreakPoint=f;"visual"===c.mode&&(k=
k.add("body"));k.addClass("tb_start_animate");"desktop"!==f&&(d=c.Utils.getBPWidth(f)-1);if("visual"===c.mode){var m=e("#themify_builder_site_canvas_iframe",top_iframe);e(".tb_toolbar_zoom_menu",top_iframe).removeClass("tb_toolbar_zoom_active").find(".tb_toolbar_zoom_menu_toggle").data("zoom",100);d="tablet_landscape"===f&&ThemifyBuilderCommon.Lightbox.dockMode.get()&&e(".themify_builder_workspace_container",top_iframe).width()<d?e(".themify_builder_workspace_container",top_iframe).width():d;c.isPreview&&
(a={tablet_landscape:1024,tablet:768,mobile:375},f in a&&(d=a[f]));m.css("width",d).parent().removeClass("themify_builder_zoom_bg");try{if(d&&m.width()!=d)m.css("will-change","width").one(c.Utils.transitionPrefix(),b);else b()}catch(q){m.css("width",e(".themify_builder_workspace_container",top_iframe).width())}}else b()}},iframeScroll:function(a){var b=e(top_iframe);b.off("scroll.themifybuilderresponsive");if(a)b.on("scroll.themifybuilderresponsive",function(){window.scrollTo(0,e(this).scrollTop())})},
responsive_grids:function(a,b){for(var c=document.querySelectorAll(".row_inner,.subrow_inner"),g="desktop"===a,f=g||"desktop"===b,h=0,k=c.length;h<k;++h){var l=c[h].getAttribute("data-basecol");if(l){var m=c[h].children,q=c[h].dataset["col_"+a],n=m[0],w=m[m.length-1];if(!g){if("desktop"!==b){c[h].classList.remove("tb_3col");var v=c[h].getAttribute("data-col_"+b);v&&c[h].classList.remove(e.trim(v.replace("tb_3col","").replace("mobile","column").replace("tablet","column")))}if(q&&"-auto"!==q){if(q=
c[h].getAttribute("data-col_"+a)){c[h].classList.add("tb_grid_classes");c[h].classList.add("col-count-"+l);var q=q.split(" "),p;for(p in q)c[h].classList.add(e.trim(q[p].replace("mobile","column").replace("tablet","column")))}}else c[h].classList.remove("tb_grid_classes"),c[h].classList.remove("col-count-"+l)}if(f)for(l=0,q=m.length;l<q;++l)v=e(m[l]).data("w"),void 0!==v&&(m[l].style.width=g?v+"%":"");"rtl"===c[h].getAttribute("data-"+a+"_dir")?(n.classList.remove("first"),n.classList.add("last"),
w.classList.remove("last"),w.classList.add("first"),c[h].classList.add("direction-rtl")):(n.classList.remove("last"),n.classList.add("first"),w.classList.remove("first"),w.classList.add("last"),c[h].classList.remove("direction-rtl"))}}},Panel:{el:null,is_locked:!1,key:"tb_module_panel_locked",init:function(){this.el=c.toolbar.$el.find(".tb_toolbar_add_modules_wrap");this.el.blur().hover(this.toogle.bind(this)).find(".tb_module_panel_lock").on("click",this.lock.bind(this));this._setupModulePanelState();
this.el.find(".add_module_btn").on("click",this.add_module)},add_module:function(a,b){a.preventDefault();a.stopPropagation();b=b||c.Instances.Builder[0].$el.find(".module_row").last().find(".themify_module_holder").first();var d=b.offset().top-37;"visual"===c.mode?"desktop"!==c.activeBreakPoint&&e(top_iframe).scrollTop(d):d-=50;e(window).scrollTop(d);c.Mixins.Builder.moduleDrop(e(a.currentTarget).closest(".themify_builder_module"),b)},resetPanel:function(){this.el.removeClass("tb_disabled");this.is_locked&&
this.toggleLock()},toogle:function(a){this.is_locked||this.el.hasClass("tb_disabled")||(e(a.currentTarget).focus(),"tb_module_panel_library_wrap"==c.toolbar.$el.find("ul.tb_module_types li.active a").data("target")&&e(document).trigger("change:tab:tb_module_panel_library_wrap",c.toolbar.$el.find("#tb_module_panel.tb_modules_panel_wrap")))},lock:function(a){a.preventDefault();this.is_locked=!this.is_locked;localStorage.setItem(this.key,this.is_locked);this.toggleLock();if(!this.is_locked){this.el.addClass("tb_hide_panel");
var b=this;setTimeout(function(){c.toolbar.$el.find("#themify_builder_switch_backend").focus();b.el.removeClass("tb_hide_panel")},1E3)}},toggleLock:function(){var a=c.toolbar.$el;"visual"===c.mode&&(a=a.add(e("body")),a.addClass("tb_remove_transitions"));e("body",top_iframe).toggleClass("tb_module_panel_locked");e(window).trigger("tfsmartresize");a.removeClass("tb_remove_transitions")},_setupModulePanelState:function(){this.is_locked=localStorage.getItem(this.key);"false"===this.is_locked&&(this.is_locked=
!1);this.is_locked&&setTimeout(this.toggleLock,1200)},hide:function(){this.el.blur();if(this.is_locked){this.el.removeClass("tb_disabled");var a=c.toolbar.$el;"visual"===c.mode&&(a=a.add(e("body")),a.addClass("tb_remove_transitions"));e("body",top_iframe).removeClass("tb_module_panel_locked");e(window).trigger("tfsmartresize");a.removeClass("tb_remove_transitions")}this.el.addClass("tb_disabled")},show:function(){this.is_locked||this.el.focus()}},toggleFavoriteModule:function(){var a=e(this),b=a.closest(".themify_builder_module_outer"),
d=a.parent().data("module-slug");e.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_module_favorite",module_name:d,module_state:+!b.hasClass("favorited")},beforeSend:function(a){function g(a,b){function f(){a.removeAttr("style");if(b){var f=0<a.closest("#tb_plus_btn_popover").length?c.toolbar.$el:e("#tb_plus_btn_popover");g(f.find(".module-type-"+d).closest(".themify_builder_module_outer"),!1)}}if(a.is(":visible"))a.css({opacity:0,transform:"scale(0.5)"}).one(h,function(){a.toggleClass("favorited").css({opacity:1,
transform:"scale(1)"}).one(h,f)});else a.toggleClass("favorited"),f()}var h=c.Utils.transitionPrefix();g(b,!0)}})},zoom:function(a){function b(){c.Utils._onResize(!0)}a.preventDefault();if("desktop"!==c.activeBreakPoint)return!0;var d=e(a.currentTarget);a=d.data("zoom");var g=e(".themify_builder_site_canvas_iframe",top_iframe),f=d.closest(".tb_toolbar_zoom_menu");d.hasClass("tb_toolbar_zoom_menu_toggle")?(a="100"==a?50:100,d.data("zoom",a),d=d.next("ul").find('[data-zoom="'+a+'"]')):f.find(".tb_toolbar_zoom_menu_toggle").data("zoom",
a);g.removeClass("themify_builder_zooming_50 themify_builder_zooming_75");d.parent().addClass("selected-zoom-size").siblings().removeClass("selected-zoom-size");"50"==a||"75"==a?(d="50"==a?2:1.25,g.addClass("themify_builder_zooming_"+a).one(c.Utils.transitionPrefix(),b).parent().addClass("themify_builder_zoom_bg").css("height",Math.max(window.parent.innerHeight*d,600)),f.addClass("tb_toolbar_zoom_active"),c.zoomMeta.isActive=!0,c.zoomMeta.size=a,e("body").addClass("tb-zoom-only")):(g.addClass("themify_builder_zooming_"+
a).one(c.Utils.transitionPrefix(),b).parent().css("height",""),f.removeClass("tb_toolbar_zoom_active"),c.zoomMeta.isActive=!1,e("body").removeClass("tb-zoom-only"))},previewBuilder:function(a){a.preventDefault();e(a.currentTarget).toggleClass("tb_toolbar_preview_active");c.isPreview=!c.isPreview;e("body").toggleClass("tb-preview-only themify_builder_active");e("body",top_iframe).toggleClass("tb-preview-parent");c.isPreview?this.Panel.hide():this.Panel.resetPanel();(function(){c.isPreview?e(".col-count-1.row_inner").each(function(){if(0===
this.getElementsByClassName("active_module").length){var a=this.getElementsByClassName("module_column")[0];if((a=c.Models.Registry.lookup(a.dataset.cid))&&0===Object.keys(a.get("styling")).length){var a=e(this).closest(".module_row"),d=c.Models.Registry.lookup(a.data("cid"));d&&0===Object.keys(d.get("styling")).length&&a.addClass("tb-hide")}}}):e(".tb-hide.module_row").removeClass("tb-hide")})();e(".builder-breakpoint-"+c.activeBreakPoint+" a.breakpoint-"+c.activeBreakPoint,top_iframe).trigger("click");
c.vent.trigger("dom:preview")}});c.Views.bindEvents=function(){ThemifyBuilderCommon.Lightbox.setup();ThemifyBuilderCommon.LiteLightbox.modal.on("attach",function(){this.$el.addClass("themify_builder_lite_lightbox_modal")});c.Utils.mediaUploader();c.Utils.openGallery()};c.Utils={onResizeEvents:[],gridClass:"col-full col2-1 col3-1 col4-1 col5-1 col6-1 col4-2 col4-3 col3-2".split(" "),_onResize:function(a,b){var d=e._data(window,"events").resize;if(""===tbLocalScript.fullwidth_support)e(window.parent).off("tfsmartresize.tb_visual").on("tfsmartresize.tb_visual",
function(a){e(window).trigger("tfsmartresize.tbfullwidth").trigger("tfsmartresize.tfVideo")});e(window.parent).off("tfsmartresize.zoom").on("tfsmartresize.zoom",function(){if(c.zoomMeta.isActive){var a="50"==c.zoomMeta.size?2:1.25;e(".themify_builder_workspace_container",top_iframe).css("height",Math.max(window.parent.innerHeight*a,600))}});if(void 0!==d)for(var g=0,f=d.length;g<f;++g)void 0!==d[g].handler&&this.onResizeEvents.push(d[g].handler);e(window).off("resize");if(a){d=e.Event("resize",{type:"resize",
isTrigger:!1});g=0;for(f=this.onResizeEvents.length;g<f;++g)try{this.onResizeEvents[g].apply(window,[d,e])}catch(h){}"function"===typeof b&&b()}},_addNewColumn:function(a,b){var d=c.Views.init_column({grid_class:a.newclass,component_name:a.component},a.type);b.append(d.view.render().$el)},filterClass:function(a){a=a.split(" ");for(var b=[],c=0,e=a.length;c<e;++c)-1!==this.gridClass.indexOf(a[c])&&b.push(a[c]);return b.join(" ")},_getRowSettings:function(a,b,d){var g={};d=d||"row";var f={};var h=c.Models.Registry.lookup(a.dataset.cid);
if(h){a=a.getElementsByClassName(d+"_inner")[0];f=a.children;d=0;for(var k=f.length;d<k;++d){var l=c.Models.Registry.lookup(f[d].dataset.cid);if(l){var m=f[d].getElementsByClassName("themify_module_holder");var q={};if(0<m.length){m=m[0].children;for(var n=0,w=m.length;n<w;++n){var v=c.Models.Registry.lookup(m[n].dataset.cid);if(v){var p=c.Utils.clear(v.get("mod_settings"),!0);q[n]={mod_name:v.get("mod_name")};0<Object.keys(p).length&&(q[n].mod_settings=p);-1!==m[n].className.indexOf("module_subrow")&&
(q[n]=this._getRowSettings(m[n],n,"subrow"))}}}g[d]={column_order:d,grid_class:this.filterClass(f[d].className)};0<Object.keys(q).length&&(g[d].modules=q);p=parseFloat(f[d].style.width);0<p&&!isNaN(p)&&(g[d].grid_width=p);p=c.Utils.clear(l.get("styling"),!0);0<Object.keys(p).length&&(g[d].styling=p)}}f={row_order:b,cols:g,column_alignment:h.get("column_alignment"),gutter:h.get("gutter")};g={gutter:"gutter-default",column_alignment:A?"col_align_middle":"col_align_top"};b={desktop_dir:"ltr",tablet_dir:"ltr",
tablet_landscape_dir:"ltr",mobile_dir:"ltr",col_tablet_landscape:"-auto",col_tablet:"-auto",col_mobile:"-auto"};for(d in f)""!==f[d]&&f[d]!==g[d]||delete f[d];p=c.Utils.clear(h.get("styling"),!0);for(d in b)h=e.trim(a.getAttribute("data-"+d)),void 0!==h&&""!==h&&h!==b[d]&&(f[d]=h);0<Object.keys(p).length&&(f.styling=p)}return f},selectedGridMenu:function(a){for(var b,d,g,f,h=a.getElementsByClassName("grid_menu"),k=["mobile","tablet","tablet_landscape","desktop"],l=0,m=h.length;l<m;++l)if(a=e(h[l]),
b=a.data("handle"),"module"!==b){d=a.closest(".module_"+b);g=c.Models.Registry.lookup(d.data("cid"));var q=[];b=d.find("."+b+"_inner").first();var n=g.get("gutter"),w=g.get("column_alignment");f=g.get("desktop_dir");for(var v=g.get("styling"),p="",x={},u=b[0].children,r=0,z=u.length;r<z;++r)q.push(c.Utils._getColClass(u[r].className.split(" "))),u[r].className=u[r].className.replace(/first|last/ig,""),1!==z&&(0===r?u[r].className+="rtl"===f?" last":" first":r===z-1&&(u[r].className+="rtl"===f?" first":
" last"));q=a.find(".themify_builder_grid_desktop .grid-layout-"+q.join("-"));r=q.data("col");0<q.length&&(q.parent().addClass("selected").siblings().removeClass("selected"),d.addClass("col-count-"+r),p="col-count-"+r,x["data-basecol"]=r);"ltr"!==f&&(p+=" direction-rtl");for(r=0;4>r;++r)f=g.get(k[r]+"_dir"),"ltr"!==f&&""!==f&&(x["data-"+k[r]+"_dir"]=f,q=a.find(".themify_builder_grid_"+k[r]+" .column-dir-"+f),q.parent().addClass("selected").siblings().removeClass("selected")),"desktop"!==k[r]&&(f=
g.get("col_"+k[r]),"-auto"!==f&&""!==f&&void 0!==f&&(x["data-col_"+k[r]]=f,q=a.find(".themify_builder_grid_"+k[r]+" .grid-layout-"+f.replace(/column|tb_3col/ig,"")),q.parent().addClass("selected").siblings().removeClass("selected")));v&&void 0!==v.row_anchor&&""!==v.row_anchor&&d.find(".row-anchor-name").first().text(v.row_anchor);"col_align_top"!==w&&(a.find(".column-alignment-"+w).parent().addClass("selected").siblings().removeClass("selected"),p+=" "+w);"gutter-default"!==n&&(a.find(".gutter_select").val(n),
p+=" "+n);b.addClass(p).attr(x)}},clear:function(a,b,c){c=c?[]:{};for(var d in a)if(Array.isArray(a[d])){var f=this.clear(a[d],b,!0);0<f.length&&(c[d]=f)}else if("object"===typeof a[d])f=this.clear(a[d],b,!1),e.isEmptyObject(f)||(c[d]=f);else if(a[d]&&"px"!==a[d]&&"pixels"!==a[d]&&"solid"!==a[d]&&"linear"!==a[d]&&"default"!==a[d]&&"|"!==a[d]&&!(-1!==d.indexOf("_gradient-css")||"cover_gradient_hover-css"===d||"background_image-css"===d||"background_image-type_gradient"===d||-1!==d.indexOf("gradient-angle")&&
"180"==a[d]||-1!==d.indexOf("_padding_apply_all_padding")||-1!==d.indexOf("_margin_apply_all_margin")||-1!==d.indexOf("_border_apply_all_border")||"text_align_right"===d||"text_align_center"===d||"text_align_left"===d||"text_align_justify"===d||"show"===a[d]&&-1!==d.indexOf("visibility_"))){if(b&&("cover_gradient_hover-gradient"===d||"background_image-gradient"===d||-1===d.indexOf("gradient-angle")&&-1!==d.indexOf("_gradient-gradient"))&&(f=-1!==d.indexOf("background_gradient")?d.replace("_gradient",
"_type").replace("-gradient",""):d.replace("-gradient","-type").replace("_gradient","_color"),"gradient"!==a[f]&&"cover_gradient"!==a[f]&&"hover_gradient"!==a[f])){f=["gradient-angle","type_image","circle-radial","gradient-type"];for(var h=d.replace("-gradient",""),k=0,l=f.length;k<l;++k){var m=h+"-"+f[k];void 0!==a[m]&&(a[m]=c[m]=null,delete a[m],delete c[m])}continue}c[d]=a[d]}return c},builderPlupload:function(a,b){var d=e(".themify-builder-plupload-upload-uic"+(b?"":"new_elemn"===a?".plupload-clone":
""),top_iframe);if(0<d.length){var g=this;void 0===g.pconfig&&(g.pconfig=JSON.parse(JSON.stringify(themify_builder_plupload_init)),g.pconfig.multipart_params._ajax_nonce=themifyBuilder.tb_load_nonce,g.pconfig.multipart_params.topost=themifyBuilder.post_ID);d.each(function(){var a=e(this),d=a.prop("id").replace("themify-builder-plupload-upload-ui",""),k=e.extend(!0,{},g.pconfig),l=["browse_button","container","drop_element","file_data_name"];k.multipart_params.imgid=d;for(var m=0,q=l.length;m<q;++m)k[l[m]]=
d+g.pconfig[l[m]];a.data("extensions")?k.filters[0].extensions=a.data("extensions"):k.filters[0].extensions=null!==c.activeModel?k.filters[0].extensions.replace(/\,zip|\,txt/,""):"zip,txt";d=new window.parent.plupload.Uploader(k);d.init();d.bind("FilesAdded",function(a,b){a.refresh();a.start();ThemifyBuilderCommon.showLoader("show")});d.bind("Error",function(a,b){var c=e(".prompt-box .show-error");e(".prompt-box .show-login").hide();c.show();0<c.length&&c.html('<p class="prompt-error">'+b.message+
"</p>");e(".overlay, .prompt-box").fadeIn(500)});d.bind("FileUploaded",function(d,f,g){var h=JSON.parse(g.response);d=e("#themify_builder_alert",top_iframe);g="200"!==g.status||h.error?"error":"done";if(h.error)ThemifyBuilderCommon.showLoader(g),alert(h.error);else if(b){var k=e("#themify_builder_row_wrapper").children().clone(!0);d.promise().done(function(){c.Forms.reLoad(h,themifyBuilder.post_ID);var a=e("#themify_builder_row_wrapper").children().clone(!0);ThemifyBuilderCommon.Lightbox.close();
c.vent.trigger("dom:change","","","","import",{before:k,after:a,bid:themifyBuilder.post_ID})})}else ThemifyBuilderCommon.showLoader(g),g=h.large_url?h.large_url:h.url,a.closest(".themify_builder_input").find(".themify-builder-uploader-input").val(g).trigger("change").parent().find(".img-placeholder").html(e("<img/>",{src:h.thumb,width:50,height:50}))});a.removeClass("plupload-clone")})}},columnDrag:function(a,b,d,g){var f=this;b&&(b=a?a.children(".module_column"):e(".module_column"),b.css("width",
""),f.setCompactMode(b));if(d&&g){a=a.children(".module_column");var h=("gutter-narrow"===d?1.6:"gutter-none"===d?0:3.2)-("gutter-narrow"===g?1.6:"gutter-none"===g?0:3.2),h=parseFloat(h*(a.length-1)/a.length);a.each(function(a){e(this).prop("style").width&&(a=parseFloat(e(this).prop("style").width)+h,e(this).css("width",a+"%"))})}else{var k={"col6-1":14,"col5-1":17.44,"col4-1":22.6,"col4-2":48.4,"col2-1":48.4,"col4-3":74.2,"col3-1":31.2,"col3-2":65.6},l={"col6-1":15.33,"col5-1":18.72,"col4-1":23.8,
"col4-2":49.2,"col2-1":49.2,"col4-3":74.539,"col3-1":32.266,"col3-2":66.05},m={"col6-1":16.666,"col5-1":20,"col4-1":25,"col4-2":50,"col2-1":50,"col4-3":75,"col3-1":33.333,"col3-2":66.666};(a?a.children(".module_column").find(".themify_grid_drag"):e(".themify_grid_drag")).each(function(){var a,b,d,g,h=0,x,u=!1,r=0,z=!1,B,A,C,G;e(this).draggable({axis:"x",cursor:"col-resize",distance:0,scroll:!1,snap:!1,containment:".row_inner",helper:function(c){a=e(c.currentTarget);b=a.closest(".subrow_inner");0===
b.length&&(b=a.closest(".row_inner"));x=a.hasClass("themify_drag_right")?"w":"e";B="w"===x?"themify_grid_drag_placeholder_right":"themify_grid_drag_placeholder_left";z=ThemifyBuilderCommon.Lightbox.clone(b.closest(".module_row"));return e('<div class="ui-widget-header themify_grid_drag_placeholder '+B+'"></div><div class="ui-widget-header themify_grid_drag_placeholder"></div>')},start:function(c,e){d=b.children(".module_column");g=a.closest(".module_column");C=b.hasClass("direction-rtl");"w"===x?
(u=C?g.prev(".module_column"):g.next(".module_column"),h=a.outerWidth()):(u=C?g.next(".module_column"):g.prev(".module_column"),h=g.outerWidth());r=u.outerWidth()-2;G=e.position.left;A=b.outerWidth()},stop:function(a,h){e(".themify_grid_drag_placeholder").remove();var p=Math.ceil(100*(g.outerWidth()/A));g.css("width",p+"%");var n=k,p=3.2;b.hasClass("gutter-narrow")?(n=l,p=1.6):b.hasClass("gutter-none")&&(n=m,p=0);var q=p*(d.length-1);d.each(function(a){a!==u.index()&&(e(this).prop("style").width?
a=parseFloat(e(this).prop("style").width):(a=e.trim(f.filterClass(e(this).attr("class")).replace("first","").replace("last","")),a=n[a]),q+=a)});u.css("width",100-q+"%");u=u.add(g);f.setCompactMode(u);p=b.closest(".module_row");c.vent.trigger("dom:change",p.data("cid"),z,p,"row")},drag:function(a,b){if(u&&0<u.length){var c=h+("e"===x?-b.position.left:b.position.left),d=parseFloat(100*c/A);if(5<=d&&100>d){var e=r+G+("w"===x?-b.position.left:b.position.left),k=parseFloat(100*e/A);5<k&&100>k&&(u.css("width",
e+"px"),g.css("width",c+"px").children("."+B).html(d.toFixed(2)+"%"),g.children(".themify_grid_drag_placeholder").last().html(k.toFixed(2)+"%"),f.setCompactMode(g))}}}})})}},setCompactMode:function(a){a instanceof jQuery&&(a=a.get());for(var b=0,c=a.length;b<c;++b){var e=a[b].clientWidth,e=234>e?["compact-mode-action","compact-mode"]:370>e?["compact-mode"]:"";a[b].classList.remove("compact-mode-action");a[b].classList.remove("compact-mode");if(""!==e)for(var f in e)a[b].classList.add(e[f]);if(""===
e||"compact-mode"===e[0])e=a[b].getElementsByClassName("sub_column"),0<e.length&&this.setCompactMode(e)}},initNewEditor:function(a){var b=tinyMCEPreInit.mceInit.tb_lb_hidden_editor;b.elements=a;b.selector="#"+a;return this.initMCEv4(a,b)},initMCEv4:function(a,b){if(3<parseInt(tinyMCE.majorVersion)){var c=new tinyMCE.Editor(a,b,tinyMCE.EditorManager);c.render();return c}},initQuickTags:function(a){"function"===typeof window.parent.QTags&&(window.parent.quicktags({id:a}),window.parent.QTags._buttonsInit())},
setColorPicker:function(a){e(".minicolors-swatch",a).each(function(){var a=e(this),d=a.closest(".minicolors_wrapper");e(this).one("click",function(){var a=d.find(".minicolors-input");d.prepend(a).find(".minicolors").remove();c.hasChanged=!0;c.Views.init_control("color",{el:a,binding_type:a.data("control-binding")})}).prev(".minicolors-input").one("focusin",function(){e(this).next(".minicolors-swatch").trigger("click")});d.find(".color_opacity").one("change",function(){a.prev(".minicolors-input").attr("data-opacity",
e(this).val());a.trigger("click")})})},_getColClass:function(a){for(var b=0,c=a.length;b<c;++b)if(-1!==this.gridClass.indexOf(a[b]))return a[b].replace("col","")},saveBuilder:function(a,b,d,g){b=b||"main";d=d||0;0===d&&("main"===b&&c.activeModel&&e(".builder_save_button",top_iframe).trigger("click"),ThemifyBuilderCommon.showLoader("show"));var f=Object.keys(c.Instances.Builder).length,h=c.Instances.Builder[d],k=this,l=h.$el.data("postid"),h=h.toJSON();(function(a,b,d,f){b={action:"tb_save_data",tb_load_nonce:themifyBuilder.tb_load_nonce,
id:a,data:JSON.stringify(b),tb_saveto:d,sourceEditor:"visual"===c.mode?"frontend":"backend"};f&&(b.only_data=f);return e.ajax({type:"POST",url:themifyBuilder.ajaxurl,cache:!1,data:b})})(l,h,b,g).always(function(g,h){++d;f===d?(e.isFunction(a)&&a.call(k,g,h),"success"!==h?ThemifyBuilderCommon.showLoader("error"):(ThemifyBuilderCommon.showLoader("hide"),c.editing=!0,e("body").trigger("themify_builder_save_data",[g,h]))):setTimeout(function(){k.saveBuilder(a,b,d)},50)})},loadContentJs:function(a,b){ThemifyBuilderModuleJs.loadOnAjax(a,
b);if(!1===c.saving){var d=e(".wp-audio-shortcode, .wp-video-shortcode",a).not(".mejs-container").filter(function(){return!e(this).parent().hasClass("mejs-mediaelement")});if(0<d.length){if(themifyBuilder.media_css){for(var g in themifyBuilder.media_css)Themify.LoadCss(themifyBuilder.media_css[g]);themifyBuilder.media_css=null}d.mediaelementplayer("undefined"!==typeof window.parent._wpmejsSettings?window.parent._wpmejsSettings:{})}}e("body").trigger("builder_load_module_partial",[a,b])},mediaUploader:function(){var a=
{};e("body",top_iframe).on("click",".themify-builder-media-uploader",function(b){b.preventDefault();b.stopPropagation();var d=e(this),g=d.closest(".themify_builder_input");b=d.data("uploader-title");var f=d.data("uploader-button-text"),d=d.data("library-type")?d.data("library-type"):"image",h=Themify.hash(d+b+f);if(void 0!==a[h])var k=a[h];else k=wp.media.frames.file_frame=wp.media({title:b,library:{type:d},button:{text:f},multiple:!1}),a[h]=k;k.off("select").on("select",function(){var a=k.state().get("selection").first().toJSON();
g.find(".themify-builder-uploader-input").val(a.url).trigger("change").parent().find(".img-placeholder").html(e("<img/>",{src:a.url,width:50,height:50}));c.hasChanged=!0;g.find(".themify-builder-uploader-input-attach-id").val(a.id)});k.open()}).on("click",".themify-builder-delete-thumb",function(a){a.preventDefault();c.hasChanged=!0;e(this).prev().empty().closest(".themify_builder_input").find(".themify-builder-uploader-input").val("").trigger("change")}).on("click",".insert-media",function(a){c.hasChanged=
!0;window.parent.wpActiveEditor=e(this).data("editor")})},openGallery:function(){var a=wp.media.gallery.shortcode,b=this,d=null;e("body",top_iframe).on("click",".tb-gallery-btn",function(g){g.preventDefault();var f=e(this).closest(".themify_builder_input").find(".tb-shortcode-input");null===d&&(d=wp.media.frames.file_frame=wp.media({frame:"post",state:"gallery-edit",title:wp.media.view.l10n.editGalleryTitle,editing:!0,multiple:!0,selection:!1}),d.$el.addClass("themify_gallery_settings"));wp.media.gallery.shortcode=
function(b){var c=b.props.toJSON(),d=_.pick(c,"orderby","order");b.gallery&&_.extend(d,b.gallery.toJSON());d.ids=b.pluck("id");c.uploadedTo&&(d.id=c.uploadedTo);d._orderbyRandom&&(d.orderby="rand",delete d._orderbyRandom);d.ids&&"post__in"===d.orderby&&delete d.orderby;_.each(wp.media.gallery.defaults,function(a,b){a===d[b]&&delete d[b]});b=new window.parent.wp.shortcode({tag:"gallery",attrs:d,type:"single"});f.val(b.string()).trigger("change");wp.media.gallery.shortcode=a;return b};d.on("update",
function(a){var d=wp.media.gallery.shortcode(a).string().slice(1,-1);f.val("["+d+"]");b.setShortcodePreview(a.models,f);c.hasChanged=!0});0<e.trim(f.val()).length?(d=wp.media.gallery.edit(e.trim(f.val())),d.state("gallery-edit").on("update",function(a){var d=wp.media.gallery.shortcode(a).string().slice(1,-1);f.val("["+d+"]");b.setShortcodePreview(a.models,f);c.hasChanged=!0})):(d.open(),d.$el.find(".media-menu .media-menu-item").last().trigger("click"))})},setShortcodePreview:function(a,b){var c=
b.next(".tb_shortcode_preview"),g="";0===c.length&&(c=e('<div class="tb_shortcode_preview"></div>'),b.after(c));for(var f=0,h=a.length;f<h;++f)var k=a[f].attributes,g=g+('<img src="'+(k.sizes.thumbnail?k.sizes.thumbnail.url:k.url)+'" width="50" height="50" />');c[0].innerHTML=g},createGradientPicker:function(a,b,d){var g=a.closest(".themify-gradient-field"),f=null,h=!1,k=a.data("id"),l=g.find("#"+k+"-gradient-angle"),m=a.prev(),q={angle:l.val(),onChange:function(b,d){h&&(b=d="");"visual"===c.mode&&
("cover_gradient"===k||"cover_gradient_hover"===k?c.liveStylingInstance.addOrRemoveComponentOverlay(k,d):c.liveStylingInstance.bindBackgroundGradient(k,d));a.val(b);themifybuilderapp.hasChanged=!0},onInit:function(){m.show()}};q.gradient=b?b:a.data("default-gradient")?a.data("default-gradient"):void 0;d||m.ThemifyGradient(q);f=a.prev().data("themifyGradient");b=g.find("#"+k+"-gradient-type");var n=g.find("#"+k+"-circle-radial input"),w=function(a){var b=l.parent(".gradient-angle-knob"),c=g.find("#"+
k+"-circle-radial");"radial"===a?(b.hide(),b.next("span").hide(),c.show()):(b.show(),b.next("span").show(),c.hide())};d?(f.settings=e.extend({},f.settings,q),f.settings.type=b.val(),f.settings.circle=n.is(":checked"),f.isInit=!1,f.update(),f.isInit=!0):(g.find(".themify-clear-gradient").on("click",function(a){a.preventDefault();h=!0;f.settings.gradient=e.ThemifyGradient["default"];f.update();h=!1}),b.on("change",function(a){f.setType(e(this).val());w(e(this).val())}),n.on("change",function(){f.setRadialCircle(e(this).is(":checked"))}),
l.on("change",function(){var a=parseInt(e(this).val());a||(a=0);f.setAngle(a)}).knob({change:function(a){f.setAngle(Math.round(a))}}),l.removeAttr("style").parent().addClass("gradient-angle-knob").find("canvas").insertAfter(l));w(b.val())},toRGBA:function(a){var b=a.split("_"),c=/^([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/;return void 0!==b[0]?(c=c.exec(b[0].replace("#","")),b=void 0!==b[1]&&"0.99"!=b[1]?b[1]:1,c?"rgba("+parseInt(c[1],16)+", "+parseInt(c[2],16)+", "+parseInt(c[3],16)+", "+b+
")":a):a},getIcon:function(a){0===a.indexOf("fa-")&&(a="fa "+a);return a},getBPWidth:function(a){a=_.isArray(themifyBuilder.breakpoints[a])?themifyBuilder.breakpoints[a]:themifyBuilder.breakpoints[a].toString().split("-");return a[a.length-1]},transitionPrefix:function(){if(void 0===this.transitionPrefix.pre){var a=document.createElement("fakeelement"),b={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},c;for(c in b)if(void 0!==
a.style[c]){this.transitionPrefix.pre=b[c];break}}return this.transitionPrefix.pre}};_.extend(c.Views.BaseElement.prototype,c.Mixins.Common);_.extend(c.Views.Builder.prototype,c.Mixins.Builder);c.Views.ControlRegistry={items:{},register:function(a,b){this.items[a]=b},lookup:function(a){return this.items[a]||null},remove:function(a){delete this.items[a]},destroy:function(){_.each(this.items,function(a,b){a.remove()});this.items={}}};c.Views.Controls["default"]=Backbone.View.extend({initialize:function(a){c.Views.ControlRegistry.register(this.$el.prop("id"),
this);a.binding_type&&(this.binding_type=a.binding_type);a.selector&&(this.selector=a.selector)},preview_element:function(a){if(void 0!==this.binding_type){c.hasChanged=!0;var b=this.$el.data("control-type"),d="repeater"===b?this.$el.prop("id"):this.$el.data("control-repeater");if(d&&"visual"===c.mode){var g=e("#"+d,top_iframe);0<g.length&&(z[d]=c.Forms.parseSettings(g[0]).v)}else z[this.$el.prop("id")]=a;"visual"===c.mode?"live"===this.binding_type?c.activeModel.trigger("custom:preview:live",z,"wp_editor"===
b||"TEXTAREA"===this.el.tagName,null,this.selector,a,this.$el):"refresh"===this.binding_type&&c.activeModel.trigger("custom:preview:refresh",z,this.selector,a,this.$el):"module"===c.activeModel.get("elType")&&c.activeModel.backendLivePreview()}}});c.Views.Controls["default"].extend=function(a){var b=this,c=Backbone.View.extend.apply(this,arguments);c.prototype.events=_.extend({},this.prototype.events,a.events);c.prototype.initialize=function(){_.isFunction(b.prototype.initialize)&&b.prototype.initialize.apply(this,
arguments);_.isFunction(a.initialize)&&a.initialize.apply(this,arguments)};return c};c.Views.register_control=function(a,b){"default"!==a&&(this.Controls[a]=this.Controls["default"].extend(b))};c.Views.get_control=function(a){return this.control_exists(a)?this.Controls[a]:this.Controls["default"]};c.Views.control_exists=function(a){return this.Controls.hasOwnProperty(a)};c.Views.init_control=function(a,b){b=b||{};b.binding_type||b.el.hasClass("minicolors-input")||(b.binding_type="refresh");a?"wp_editor"===
a&&b.el.hasClass("data_control_binding_live")&&(b.binding_type="live"):a="change";var d=b.el.data("input-id");d||(d=b.el.prop("id"));return"wp_editor"!==a&&(d=this.ControlRegistry.lookup(d),null!==d)?(d.setElement(b.el).render(),d):new (c.Views.get_control(a))(b)};c.Views.register_control("wp_editor",{initialize:function(){this.render()},render:function(){var a=this,b="refresh"===this.binding_type&&void 0===this.selector?1E3:50,d=this.$el.prop("id"),g="",b=_.throttle(function(b){b="setupeditor"===
this.type?this.getContent():e(this).val();null!==c.activeModel&&g!==b&&(g=b,!1!==f?a.$el.val(b).trigger("change"):a.preview_element(b))},b);c.Utils.initQuickTags(d);if(void 0!==tinyMCE&&void 0!==this.binding_type){_.isUndefined(tinymce.editors[d])||tinyMCE.execCommand("mceRemoveEditor",!0,d);d=c.Utils.initNewEditor(d);var f=this.$el.hasClass("wp-editor-area")?0<this.$el.closest("#instance_widget").length:!1;d.on("change keyup",b)}this.$el.on("change keyup",b);return this}});c.Views.register_control("change",
{initialize:function(){this.render()},render:function(){var a=this,b="refresh"===this.binding_type&&void 0===this.selector?1E3:50,c=this.$el.data("control-event");if(void 0===c||""===c)c="change",b=1;this.$el.on(c,_.throttle(function(){a.preview_element(this.value)},b));return this}});c.Views.register_control("query_category",{initialize:function(){this.render()},render:function(){var a=this,b=a.$el.parent(),c=b.find(".query_category_single"),g=b.find(".query_category_multiple");c.add(g).on("change",
function(b){var d=(b=e(this).hasClass("query_category_single"))?c.val()+"|single":g.val()+"|multiple";b&&g.val(e(this).val());a.preview_element(d)});return this}});c.Views.register_control("layout",{initialize:function(){this.render()},render:function(){var a=this,b=this.$el.data("input-id"),d=a.$(".tfl-icon.selected").prop("id");b||(b=this.$el.prop("id"));this.$(".tfl-icon").on("click",function(g){g.preventDefault();var f=e(this);g=f.prop("id");f.addClass("selected").siblings().removeClass("selected");
if("visual"===c.mode&&"live"===a.binding_type&&void 0!==a.$el.data("control-selector")){var f=c.liveStylingInstance.$liveStyledElmt,h=c.liveStylingInstance.getStylingVal(b);""!==a.$el.data("control-selector")&&(f=c.liveStylingInstance.$liveStyledElmt.find(a.$el.data("control-selector")));z[b]=g;"layout_feature"===b?(g="layout-"+g,h="layout-"+h):"columns"===b&&(g=b+"-"+g,h=b+"-"+h);!h&&d&&(h=d);f.removeClass(h).addClass(g);"layout_feature"===b?g=g.substr(7):"columns"===b&&(g=g.substr(8));c.liveStylingInstance.setStylingVal(b,
g);c.hasChanged=!0}else a.preview_element(g)});return this}});c.Views.register_control("radio",{initialize:function(){this.render()},render:function(){var a=this;this.$('input[type="radio"]').on("change",function(){a.preview_element(this.value)});return this}});c.Views.register_control("checkbox",{initialize:function(){this.render()},render:function(){var a=this;this.$('input[type="checkbox"]').on("click",function(){if(!_.isUndefined(a.binding_type)){var b=a.$('input[type="checkbox"]:checked').map(function(){return this.value}).get();
a.preview_element(b.join("|"))}});return this}});c.Views.register_control("color",{is_typing:!1,initialize:function(){this.render()},render:function(){var a=this,b=this.$el.next(".color_opacity"),d=this.$el.prop("id");this.$el.minicolors({opacity:1,changeDelay:200,beforeShow:function(){var b=ThemifyBuilderCommon.Lightbox.$lightbox,c=a.$el.closest(".minicolors"),d=c.find(".minicolors-panel");d.css("visibility","hidden").show();b.offset().left+b.width()<=d.offset().left+d.width()?c.addClass("tb-minicolors-right"):
c.removeClass("tb-minicolors-right");d.css("visibility","").hide()},change:function(g,f){g?f&&"0.99"==f&&(f=1):f="";a.is_typing||b.is(":focus")||b.attr("data-opacity",f).data("opacity",f).val(f);var h=g?e(this).minicolors("rgbaString"):"";void 0!==a.binding_type?a.preview_element(h):"visual"===c.mode&&e("body").trigger("themify_builder_color_picker_change",[d,a.$el,g?h:""])}}).minicolors("show");b.on("blur keyup",function(b){var c=parseFloat(e.trim(e(this).val()));if(1<c||isNaN(c)||""===c||0>c)c=
a.$el.val()?1:"","blur"===b.type&&e(this).val(c);e(this).attr("data-opacity",c);a.is_typing="keyup"===b.type;a.$el.minicolors("opacity",c)})}});c.Views.register_control("repeater",{events:{"click .toggle_row":"toggleField","click .themify_builder_duplicate_row":"duplicateRowField","click .themify_builder_delete_row":"deleteRowField"},initialize:function(){this.render()},render:function(){var a=this.$el,b=this,c=!1;a.sortable({items:".tb_repeatable_field",handle:".tb_repeatable_field_top",axis:"y",
placeholder:"themify_builder_ui_state_highlight",tolerance:"pointer",cursor:"move",start:_.debounce(function(b,c){void 0!==tinyMCE&&a.find(".tb_lb_wp_editor").each(function(){var a=e(this).prop("id"),b=tinymce.get(a).getContent();e(this).data("content",b);tinyMCE.execCommand("mceRemoveEditor",!1,a)})},300),stop:_.debounce(function(d,f){void 0!==tinyMCE&&a.find(".tb_lb_wp_editor").each(function(){var a=e(this).prop("id");tinyMCE.execCommand("mceAddEditor",!1,a);tinymce.get(a).setContent(e(this).data("content"))});
c&&(f.item.removeClass("collapsed").find(".tb_repeatable_field_content").show(),c=!1);a.find(".themify_builder_ui_state_highlight").remove();b.preview_element()},300),sort:function(b,c){a.find(".themify_builder_ui_state_highlight").height(30)},beforeStart:function(b,d){d.item.hasClass("collapsed")||(d.item.addClass("collapsed").find(".tb_repeatable_field_content").hide(),c=!0,a.sortable("refresh"))}});return this},toggleField:function(a){a.preventDefault();e(a.currentTarget).closest(".tb_repeatable_field").toggleClass("collapsed").find(".tb_repeatable_field_content").slideToggle()},
duplicateRowField:function(a){a.preventDefault();a.stopPropagation();this.$el.next(".add_new").find("a").trigger("click",e(a.currentTarget).closest(".tb_repeatable_field"));this.preview_element()},deleteRowField:function(a){a.preventDefault();a.stopPropagation();confirm(themifyBuilder.i18n.rowDeleteConfirm)&&(e(a.currentTarget).closest(".tb_repeatable_field").remove(),this.preview_element())}});c.Views.register_control("widget_form",{initialize:function(){this.render()},render:function(){this.$el.on("change",
":input",this._updateWidgetPreview.bind(this));return this},_updateWidgetPreview:function(){this.preview_element(this.$el.find(":input").themifySerializeObject())}})})(jQuery);
